#!! ---------------------------------------------------
#!! LIMIT
#!! config to configure datacard and workspace writing
#!! ----------------------------------------------------

[LimitGeneral]
#!! --------------------------------------
##!! Binning:
##!! --------------------------------------

HMassRange = 12,60,180
EtabbRange = 32,0,5
btagrange = 50,0,1
BDTrange = 15,-1,1

;DNN
;BDTrange = 15,0,1
;IMPORTANT: this has to be exacly the same as the variable in vhbbPlotDef for the pre/postfit macro to work
;
;Ragne for mjj datacards
;MassRange = 12,60,180
Mass = H_mass
MassRange = 17,0,255
MassRangeVV = 34,0, 255

;;;;;;
;Variable to plot
;;;;;;

;New
;MVA
bTagVar = <!Cuts|Jet_btag!>[<!Cuts|btagidx1!>]

BDTlow = <!ZllBDT_lowpt2017_18|branchName!>.Nominal
BDThigh = <!ZllBDT_highpt2017_18|branchName!>.Nominal

;BDT VV
BDTVVlow = ZllBDTVV_lowpt.Nominal
BDTVVhigh = ZllBDTVV_highpt.Nominal
bTagVarRange = 2,0,1

#only 1 bin with normalization
normVar = 0.5
normRange = 1,0,1

;!! --------------------------------------
;!! Systematics
;!! --------------------------------------

sys_cr = [
#Default
    'jer',
    'jerReg',
    'jesAbsoluteStat',
    'jesAbsoluteScale',
    'jesAbsoluteFlavMap',
    'jesAbsoluteMPFBias',
    'jesFragmentation',
    'jesSinglePionECAL',
    'jesSinglePionHCAL',
    'jesFlavorQCD',
    'jesRelativeJEREC1',
    'jesRelativeJEREC2',
    'jesRelativeJERHF',
    'jesRelativePtBB',
    'jesRelativePtEC1',
    'jesRelativePtEC2',
    'jesRelativePtHF',
    'jesRelativeBal',
    'jesRelativeFSR',
    'jesRelativeStatFSR',
    'jesRelativeStatEC',
    'jesRelativeStatHF',
    'jesPileUpDataMC',
    'jesPileUpPtRef',
    'jesPileUpPtBB',
    'jesPileUpPtEC1',
    'jesPileUpPtEC2',
    'jesPileUpPtHF',
    'jesPileUpMuZero',
    'jesPileUpEnvelope',
    ]

sys_BDT = <!LimitGeneral|sys_cr!>
sys_Mjj = <!LimitGeneral|sys_cr!>

weightF_sys = [
; LO to NLO weight
;    'CMS_vhbb_DY_NLO_weight',
    'CMS_vhbb_vjetnlodetajjrw_13TeV',
; LO to NLO weight decorrelated
; -> now done in CH!
;    'CMS_vhbb_vjetnlodetajjrw_13TeV_Zj0b',
;    'CMS_vhbb_vjetnlodetajjrw_13TeV_Zj1b',
;    'CMS_vhbb_vjetnlodetajjrw_13TeV_Zj2b',
; top pt reweighting
    'CMS_vhbb_topptreweighting_13TeV',
; Pileup
    'CMS_vhbb_puWeight',
; LHE scale
    'CMS_LHE_weights_scale_muR_ZH',
    'CMS_LHE_weights_scale_muR_ggZH',
    'CMS_LHE_weights_scale_muR_TT',
    'CMS_LHE_weights_scale_muR_Zj0b',
    'CMS_LHE_weights_scale_muR_Zj1b',
    'CMS_LHE_weights_scale_muR_Zj2b',
;   broken
;    'CMS_LHE_weights_scale_muR_VVHF',
;    'CMS_LHE_weights_scale_muR_VVLF',
    'CMS_LHE_weights_scale_muF_ZH',
    'CMS_LHE_weights_scale_muF_ggZH',
    'CMS_LHE_weights_scale_muF_TT',
    'CMS_LHE_weights_scale_muF_Zj0b',
    'CMS_LHE_weights_scale_muF_Zj1b',
    'CMS_LHE_weights_scale_muF_Zj2b',
;   broken
;    'CMS_LHE_weights_scale_muF_VVHF',
;    'CMS_LHE_weights_scale_muF_VVLF',
; EWK signal correction
    'CMS_vhbb_signal_ewk_13TeV',
; electron SF
    'CMS_vhbb_eff_e_trigger_Zll_13TeV',
    'CMS_vhbb_eff_e_MVAID_Zll_eta0_13TeV',
    'CMS_vhbb_eff_e_MVAID_Zll_eta1_13TeV',
; muon SF
; broken somehow
;   'CMS_vhbb_eff_m_trigger_Zll_13TeV',
    'CMS_vhbb_eff_m_ISO_Zll_13TeV',
    'CMS_vhbb_eff_m_MVAID_Zll_13TeV',
;   'CMS_vhbb_eff_m_tracker_Zll_13TeV',
; btag
    'btagWeight_jes_pt0_eta1',
    'btagWeight_jes_pt0_eta2',
    'btagWeight_jes_pt0_eta3',
    'btagWeight_jes_pt1_eta1',
    'btagWeight_jes_pt1_eta2',
    'btagWeight_jes_pt1_eta3',
    'btagWeight_jes_pt2_eta1',
    'btagWeight_jes_pt2_eta2',
    'btagWeight_jes_pt2_eta3',
    'btagWeight_jes_pt3_eta1',
    'btagWeight_jes_pt3_eta2',
    'btagWeight_jes_pt3_eta3',
    'btagWeight_jes_pt4_eta1',
    'btagWeight_jes_pt4_eta2',
    'btagWeight_jes_pt4_eta3',
;
    'btagWeight_lf_pt0_eta1',
    'btagWeight_lf_pt0_eta2',
    'btagWeight_lf_pt0_eta3',
    'btagWeight_lf_pt1_eta1',
    'btagWeight_lf_pt1_eta2',
    'btagWeight_lf_pt1_eta3',
    'btagWeight_lf_pt2_eta1',
    'btagWeight_lf_pt2_eta2',
    'btagWeight_lf_pt2_eta3',
    'btagWeight_lf_pt3_eta1',
    'btagWeight_lf_pt3_eta2',
    'btagWeight_lf_pt3_eta3',
    'btagWeight_lf_pt4_eta1',
    'btagWeight_lf_pt4_eta2',
    'btagWeight_lf_pt4_eta3',
;
    'btagWeight_hf_pt0_eta1',
    'btagWeight_hf_pt0_eta2',
    'btagWeight_hf_pt0_eta3',
    'btagWeight_hf_pt1_eta1',
    'btagWeight_hf_pt1_eta2',
    'btagWeight_hf_pt1_eta3',
    'btagWeight_hf_pt2_eta1',
    'btagWeight_hf_pt2_eta2',
    'btagWeight_hf_pt2_eta3',
    'btagWeight_hf_pt3_eta1',
    'btagWeight_hf_pt3_eta2',
    'btagWeight_hf_pt3_eta3',
    'btagWeight_hf_pt4_eta1',
    'btagWeight_hf_pt4_eta2',
    'btagWeight_hf_pt4_eta3',
;
    'btagWeight_lfstats1_pt0_eta1',
    'btagWeight_lfstats1_pt0_eta2',
    'btagWeight_lfstats1_pt0_eta3',
    'btagWeight_lfstats1_pt1_eta1',
    'btagWeight_lfstats1_pt1_eta2',
    'btagWeight_lfstats1_pt1_eta3',
    'btagWeight_lfstats1_pt2_eta1',
    'btagWeight_lfstats1_pt2_eta2',
    'btagWeight_lfstats1_pt2_eta3',
    'btagWeight_lfstats1_pt3_eta1',
    'btagWeight_lfstats1_pt3_eta2',
    'btagWeight_lfstats1_pt3_eta3',
    'btagWeight_lfstats1_pt4_eta1',
    'btagWeight_lfstats1_pt4_eta2',
    'btagWeight_lfstats1_pt4_eta3',
;
    'btagWeight_lfstats2_pt0_eta1',
    'btagWeight_lfstats2_pt0_eta2',
    'btagWeight_lfstats2_pt0_eta3',
    'btagWeight_lfstats2_pt1_eta1',
    'btagWeight_lfstats2_pt1_eta2',
    'btagWeight_lfstats2_pt1_eta3',
    'btagWeight_lfstats2_pt2_eta1',
    'btagWeight_lfstats2_pt2_eta2',
    'btagWeight_lfstats2_pt2_eta3',
    'btagWeight_lfstats2_pt3_eta1',
    'btagWeight_lfstats2_pt3_eta2',
    'btagWeight_lfstats2_pt3_eta3',
    'btagWeight_lfstats2_pt4_eta1',
    'btagWeight_lfstats2_pt4_eta2',
    'btagWeight_lfstats2_pt4_eta3',
;
    'btagWeight_hfstats1_pt0_eta1',
    'btagWeight_hfstats1_pt0_eta2',
    'btagWeight_hfstats1_pt0_eta3',
    'btagWeight_hfstats1_pt1_eta1',
    'btagWeight_hfstats1_pt1_eta2',
    'btagWeight_hfstats1_pt1_eta3',
    'btagWeight_hfstats1_pt2_eta1',
    'btagWeight_hfstats1_pt2_eta2',
    'btagWeight_hfstats1_pt2_eta3',
    'btagWeight_hfstats1_pt3_eta1',
    'btagWeight_hfstats1_pt3_eta2',
    'btagWeight_hfstats1_pt3_eta3',
    'btagWeight_hfstats1_pt4_eta1',
    'btagWeight_hfstats1_pt4_eta2',
    'btagWeight_hfstats1_pt4_eta3',
;
    'btagWeight_hfstats2_pt0_eta1',
    'btagWeight_hfstats2_pt0_eta2',
    'btagWeight_hfstats2_pt0_eta3',
    'btagWeight_hfstats2_pt1_eta1',
    'btagWeight_hfstats2_pt1_eta2',
    'btagWeight_hfstats2_pt1_eta3',
    'btagWeight_hfstats2_pt2_eta1',
    'btagWeight_hfstats2_pt2_eta2',
    'btagWeight_hfstats2_pt2_eta3',
    'btagWeight_hfstats2_pt3_eta1',
    'btagWeight_hfstats2_pt3_eta2',
    'btagWeight_hfstats2_pt3_eta3',
    'btagWeight_hfstats2_pt4_eta1',
    'btagWeight_hfstats2_pt4_eta2',
    'btagWeight_hfstats2_pt4_eta3',
;
    'btagWeight_cferr1_pt0_eta1',
    'btagWeight_cferr1_pt0_eta2',
    'btagWeight_cferr1_pt0_eta3',
    'btagWeight_cferr1_pt1_eta1',
    'btagWeight_cferr1_pt1_eta2',
    'btagWeight_cferr1_pt1_eta3',
    'btagWeight_cferr1_pt2_eta1',
    'btagWeight_cferr1_pt2_eta2',
    'btagWeight_cferr1_pt2_eta3',
    'btagWeight_cferr1_pt3_eta1',
    'btagWeight_cferr1_pt3_eta2',
    'btagWeight_cferr1_pt3_eta3',
    'btagWeight_cferr1_pt4_eta1',
    'btagWeight_cferr1_pt4_eta2',
    'btagWeight_cferr1_pt4_eta3',
;
    'btagWeight_cferr2_pt0_eta1',
    'btagWeight_cferr2_pt0_eta2',
    'btagWeight_cferr2_pt0_eta3',
    'btagWeight_cferr2_pt1_eta1',
    'btagWeight_cferr2_pt1_eta2',
    'btagWeight_cferr2_pt1_eta3',
    'btagWeight_cferr2_pt2_eta1',
    'btagWeight_cferr2_pt2_eta2',
    'btagWeight_cferr2_pt2_eta3',
    'btagWeight_cferr2_pt3_eta1',
    'btagWeight_cferr2_pt3_eta2',
    'btagWeight_cferr2_pt3_eta3',
    'btagWeight_cferr2_pt4_eta1',
    'btagWeight_cferr2_pt4_eta2',
    'btagWeight_cferr2_pt4_eta3',
    ]

rebin_active = True
;rebin_active = False 

;use looser cuts for caching and then cut tight when producing the datacard. Speed up if minmax branches are present
useMinmaxCuts = True

;_*_*_*_*_*_*_*_*_*_*_*_*_*_*_*_*_*
;Common
;_*_*_*_*_*_*_*_*_*_*_*_*_*_*_*_*_*

;!! configuration of systematics effects and behaviour
sys_factor = {
    'jesTotal':1.0,
    'jer':1.0,
    'jerReg':1.0,
    'jesAbsoluteStat':1.0,
    'jesAbsoluteScale':1.0,
    'jesAbsoluteFlavMap':1.0,
    'jesAbsoluteMPFBias':1.0,
    'jesFragmentation':1.0,
    'jesSinglePionECAL':1.0,
    'jesSinglePionHCAL':1.0,
    'jesFlavorQCD':1.0,
    'jesRelativeJEREC1':1.0,
    'jesRelativeJEREC2':1.0,
    'jesRelativeJERHF':1.0,
    'jesRelativePtBB':1.0,
    'jesRelativePtEC1':1.0,
    'jesRelativePtEC2':1.0,
    'jesRelativePtHF':1.0,
    'jesRelativeBal':1.0,
    'jesRelativeFSR':1.0,
    'jesRelativeStatFSR':1.0,
    'jesRelativeStatEC':1.0,
    'jesRelativeStatHF':1.0,
    'jesPileUpDataMC':1.0,
    'jesPileUpPtRef':1.0,
    'jesPileUpPtBB':1.0,
    'jesPileUpPtEC1':1.0,
    'jesPileUpPtEC2':1.0,
    'jesPileUpPtHF':1.0,
    'jesPileUpMuZero':1.0,
    'jesPileUpEnvelope':1.0,
    }
;now
affecting_all = ['ZH','DYlight','DY2b','DY1b','TT','ggZH','ZHbb','ZJets_2b','ZJets_1b','ZJets_0b','VV','VVLF','VVHF']
sys_affecting = {'jesTotal':<!LimitGeneral|affecting_all!>,'jer':<!LimitGeneral|affecting_all!>,'jerReg':<!LimitGeneral|affecting_all!>,'jesAbsoluteStat':<!LimitGeneral|affecting_all!>,'jesAbsoluteScale':<!LimitGeneral|affecting_all!>,'jesAbsoluteFlavMap':<!LimitGeneral|affecting_all!>,'jesAbsoluteMPFBias':<!LimitGeneral|affecting_all!>,'jesFragmentation':<!LimitGeneral|affecting_all!>,'jesSinglePionECAL':<!LimitGeneral|affecting_all!>,'jesSinglePionHCAL':<!LimitGeneral|affecting_all!>,'jesFlavorQCD':<!LimitGeneral|affecting_all!>,'jesRelativeJEREC1':<!LimitGeneral|affecting_all!>,'jesRelativeJEREC2':<!LimitGeneral|affecting_all!>,'jesRelativeJERHF':<!LimitGeneral|affecting_all!>,'jesRelativePtBB':<!LimitGeneral|affecting_all!>,'jesRelativePtEC1':<!LimitGeneral|affecting_all!>,'jesRelativePtEC2':<!LimitGeneral|affecting_all!>,'jesRelativePtHF':<!LimitGeneral|affecting_all!>,'jesRelativeBal':<!LimitGeneral|affecting_all!>,'jesRelativeFSR':<!LimitGeneral|affecting_all!>,'jesRelativeStatFSR':<!LimitGeneral|affecting_all!>,'jesRelativeStatEC':<!LimitGeneral|affecting_all!>,'jesRelativeStatHF':<!LimitGeneral|affecting_all!>,'jesPileUpDataMC':<!LimitGeneral|affecting_all!>,'jesPileUpPtRef':<!LimitGeneral|affecting_all!>,'jesPileUpPtBB':<!LimitGeneral|affecting_all!>,'jesPileUpPtEC1':<!LimitGeneral|affecting_all!>,'jesPileUpPtEC2':<!LimitGeneral|affecting_all!>,'jesPileUpPtHF':<!LimitGeneral|affecting_all!>,'jesPileUpMuZero':<!LimitGeneral|affecting_all!>,'jesPileUpEnvelope':<!LimitGeneral|affecting_all!>}
# kin fit
replace_cut_KINFIT1 = [
        'kinFit.H_mass_fit_fallback>kinFit.H_mass_fit_fallback*H_mass_{syst}_{UD}/H_mass', 
        'kinFit.H_phi_fit_fallback>kinFit.H_phi_fit_fallback*H_phi_{syst}_{UD}/H_phi', 
        'Jet_Pt[hJidx[0]]>Jet_pt_{syst}{UD}[hJidx[0]]',
        'Jet_Pt[hJidx[1]]>Jet_pt_{syst}{UD}[hJidx[1]]',
        'Jet_Pt[hJidxCMVA[0]]>Jet_pt_{syst}{UD}[hJidxCMVA[0]]',
        'Jet_Pt[hJidxCMVA[1]]>Jet_pt_{syst}{UD}[hJidxCMVA[1]]',
        'Jet_PtReg[hJidx[0]]>Jet_PtReg[hJidx[0]]*Jet_pt_{syst}{UD}[hJidx[0]]/Jet_Pt[hJidx[0]]',
        'Jet_PtReg[hJidx[1]]>Jet_PtReg[hJidx[1]]*Jet_pt_{syst}{UD}[hJidx[1]]/Jet_Pt[hJidx[1]]',
        'Jet_PtReg[hJidxCMVA[0]]>Jet_PtReg[hJidxCMVA[0]]*Jet_pt_{syst}{UD}[hJidxCMVA[0]]/Jet_Pt[hJidxCMVA[0]]',
        'Jet_PtReg[hJidxCMVA[1]]>Jet_PtReg[hJidxCMVA[1]]*Jet_pt_{syst}{UD}[hJidxCMVA[1]]/Jet_Pt[hJidxCMVA[1]]',
        'Jet_mass>Jet_mass_{syst}{UD}', 
        'kinFit.H_pt_fit_fallback>kinFit.H_pt_fit_fallback*H_pt_{syst}_{UD}/H_pt', 
        'kinFit.H_eta_fit_fallback>kinFit.H_eta_fit_fallback*H_eta_{syst}_{UD}/H_eta'
    ]
replace_cut_REG = [
        'H_mass>H_mass_{syst}_{UD}', 
        'H_phi>H_phi_{syst}_{UD}', 
        'Jet_Pt[hJidx[0]]>Jet_pt_{syst}{UD}[hJidx[0]]',
        'Jet_Pt[hJidx[1]]>Jet_pt_{syst}{UD}[hJidx[1]]',
        'Jet_Pt[hJidxCMVA[0]]>Jet_pt_{syst}{UD}[hJidxCMVA[0]]',
        'Jet_Pt[hJidxCMVA[1]]>Jet_pt_{syst}{UD}[hJidxCMVA[1]]',
        'Jet_PtReg[hJidx[0]]>Jet_PtReg[hJidx[0]]*Jet_pt_{syst}{UD}[hJidx[0]]/Jet_Pt[hJidx[0]]',
        'Jet_PtReg[hJidx[1]]>Jet_PtReg[hJidx[1]]*Jet_pt_{syst}{UD}[hJidx[1]]/Jet_Pt[hJidx[1]]',
        'Jet_PtReg[hJidxCMVA[0]]>Jet_PtReg[hJidxCMVA[0]]*Jet_pt_{syst}{UD}[hJidxCMVA[0]]/Jet_Pt[hJidxCMVA[0]]',
        'Jet_PtReg[hJidxCMVA[1]]>Jet_PtReg[hJidxCMVA[1]]*Jet_pt_{syst}{UD}[hJidxCMVA[1]]/Jet_Pt[hJidxCMVA[1]]',
        'Jet_mass>Jet_mass_{syst}{UD}', 
        'H_pt>H_pt_{syst}_{UD}', 
        'H_eta>H_eta_{syst}_{UD}'
    ]
replace_cut = <!LimitGeneral|replace_cut_<!General|Htype!>!>

# JER variation from regression is implemented differently than the rest...
replace_cut_jerReg = [
    ]
sys_cut_replacement_final = {'jerReg': [
        ['Jet_PtReg[hJidx[0]]*Jet_pt_jerRegUp[hJidx[0]]/Jet_Pt[hJidx[0]]','Jet_PtRegUp[hJidx[0]]'],
        ['Jet_PtReg[hJidx[1]]*Jet_pt_jerRegUp[hJidx[1]]/Jet_Pt[hJidx[1]]','Jet_PtRegUp[hJidx[1]]'], 
        ['Jet_PtReg[hJidx[0]]*Jet_pt_jerRegDown[hJidx[0]]/Jet_Pt[hJidx[0]]','Jet_PtRegDown[hJidx[0]]'],
        ['Jet_PtReg[hJidx[1]]*Jet_pt_jerRegDown[hJidx[1]]/Jet_Pt[hJidx[1]]','Jet_PtRegDown[hJidx[1]]'], 
    ]}

sys_cut_suffix = {'jesTotal':<!LimitGeneral|replace_cut!>,'jer':<!LimitGeneral|replace_cut!>,'jerReg':<!LimitGeneral|replace_cut_jerReg!>,'jesAbsoluteStat':<!LimitGeneral|replace_cut!>,'jesAbsoluteScale':<!LimitGeneral|replace_cut!>,'jesAbsoluteFlavMap':<!LimitGeneral|replace_cut!>,'jesAbsoluteMPFBias':<!LimitGeneral|replace_cut!>,'jesFragmentation':<!LimitGeneral|replace_cut!>,'jesSinglePionECAL':<!LimitGeneral|replace_cut!>,'jesSinglePionHCAL':<!LimitGeneral|replace_cut!>,'jesFlavorQCD':<!LimitGeneral|replace_cut!>,'jesRelativeJEREC1':<!LimitGeneral|replace_cut!>,'jesRelativeJEREC2':<!LimitGeneral|replace_cut!>,'jesRelativeJERHF':<!LimitGeneral|replace_cut!>,'jesRelativePtBB':<!LimitGeneral|replace_cut!>,'jesRelativePtEC1':<!LimitGeneral|replace_cut!>,'jesRelativePtEC2':<!LimitGeneral|replace_cut!>,'jesRelativePtHF':<!LimitGeneral|replace_cut!>,'jesRelativeBal':<!LimitGeneral|replace_cut!>,'jesRelativeFSR':<!LimitGeneral|replace_cut!>,'jesRelativeStatFSR':<!LimitGeneral|replace_cut!>,'jesRelativeStatEC':<!LimitGeneral|replace_cut!>,'jesRelativeStatHF':<!LimitGeneral|replace_cut!>,'jesPileUpDataMC':<!LimitGeneral|replace_cut!>,'jesPileUpPtRef':<!LimitGeneral|replace_cut!>,'jesPileUpPtBB':<!LimitGeneral|replace_cut!>,'jesPileUpPtEC1':<!LimitGeneral|replace_cut!>,'jesPileUpPtEC2':<!LimitGeneral|replace_cut!>,'jesPileUpPtHF':<!LimitGeneral|replace_cut!>,'jesPileUpMuZero':<!LimitGeneral|replace_cut!>,'jesPileUpEnvelope':<!LimitGeneral|replace_cut!>}

# for 2017 nano JER smearing fix
#sys_cut_dict = dict(list({'H_'+x+'>':'H_mass_{syst}_{Up}>' for x in ['pt','eta','phi','mass']}.items())+list({'H_'+x+'<':'H_mass_{syst}_{Down}<' for x in ['pt','eta','phi','mass']}.items())+[('(Jet_PtFixed[hJidx[0]]/Jet_pt[hJidx[0]])>','(Jet_pt_{syst}{Up}[hJidx[0]]/Jet_pt[hJidx[0]])>'),('(Jet_PtFixed[hJidx[1]]/Jet_pt[hJidx[1]])>','(Jet_pt_{syst}{Up}[hJidx[1]]/Jet_pt[hJidx[1]])>'),('(Jet_PtFixed[hJidx[0]]/Jet_pt[hJidx[0]])<','(Jet_pt_{syst}{Down}[hJidx[0]]/Jet_pt[hJidx[0]])<'),('(Jet_PtFixed[hJidx[1]]/Jet_pt[hJidx[1]])<','(Jet_pt_{syst}{Down}[hJidx[1]]/Jet_pt[hJidx[1]])<')])

sys_cut_dict_KINFIT1 = {
        'Jet_PtReg[hJidx[0]]>': 'Jet_PtReg[hJidx[0]]*Jet_pt_{syst}{Up}[hJidx[0]]/Jet_Pt[hJidx[0]]>',
        'Jet_PtReg[hJidx[0]]<': 'Jet_PtReg[hJidx[0]]*Jet_pt_{syst}{Down}[hJidx[0]]/Jet_Pt[hJidx[0]]<',
        'Jet_PtReg[hJidx[1]]>': 'Jet_PtReg[hJidx[1]]*Jet_pt_{syst}{Up}[hJidx[1]]/Jet_Pt[hJidx[1]]>',
        'Jet_PtReg[hJidx[1]]<': 'Jet_PtReg[hJidx[1]]*Jet_pt_{syst}{Down}[hJidx[1]]/Jet_Pt[hJidx[1]]<',
        'kinFit.H_mass_fit_fallback>': 'kinFit.H_mass_fit_fallback*H_mass_{syst}_{Up}/H_mass>',
        'kinFit.H_mass_fit_fallback<': 'kinFit.H_mass_fit_fallback*H_mass_{syst}_{Down}/H_mass<',
        'kinFit.H_pt_fit_fallback>': 'kinFit.H_pt_fit_fallback*H_pt_{syst}_{Up}/H_pt>',
        'kinFit.H_pt_fit_fallback<': 'kinFit.H_pt_fit_fallback*H_pt_{syst}_{Down}/H_pt<',
        'kinFit.H_eta_fit>': 'kinFit.H_eta_fit*H_eta_{syst}_{Up}/H_eta>',
        'kinFit.H_eta_fit<': 'kinFit.H_eta_fit*H_eta_{syst}_{Down}/H_eta<',
        'kinFit.H_phi_fit>': 'kinFit.H_phi_fit*H_phi_{syst}_{Up}/H_phi>',
        'kinFit.H_phi_fit<': 'kinFit.H_phi_fit*H_phi_{syst}_{Down}/H_phi<',
    }
sys_cut_dict_REG = {
        'Jet_PtReg[hJidx[0]]>': 'Jet_PtReg[hJidx[0]]*Jet_pt_{syst}{Up}[hJidx[0]]/Jet_Pt[hJidx[0]]>',
        'Jet_PtReg[hJidx[0]]<': 'Jet_PtReg[hJidx[0]]*Jet_pt_{syst}{Down}[hJidx[0]]/Jet_Pt[hJidx[0]]<',
        'Jet_PtReg[hJidx[1]]>': 'Jet_PtReg[hJidx[1]]*Jet_pt_{syst}{Up}[hJidx[1]]/Jet_Pt[hJidx[1]]>',
        'Jet_PtReg[hJidx[1]]<': 'Jet_PtReg[hJidx[1]]*Jet_pt_{syst}{Down}[hJidx[1]]/Jet_Pt[hJidx[1]]<',
        'H_mass>': 'H_mass_{syst}_{Up}>',
        'H_mass<': 'H_mass_{syst}_{Down}<',
        'H_pt>': 'H_pt_{syst}_{Up}>',
        'H_pt<': 'H_pt_{syst}_{Down}<',
    }

sys_cut_dict = <!LimitGeneral|sys_cut_dict_<!General|Htype!>!>


sys_weight_corr ={}
ggZH_ShowerShape = [
    ['ggZH_HToBB_ZToLL_M125_pow_ext1','ggZH_HToBB_ZToLL_M125_pow_ext2'],
    ['ggZH_HToBB_ZToLL_M125_13TeV_powheg_pythia8_CUETP8M1Down'],
    ['ggZH_HToBB_ZToLL_M125_13TeV_powheg_pythia8_CUETP8M1Up']]
ZH_ShowerShape = [
    ['ZH_HToBB_ZToLL_M125_pow','ZH_HToBB_ZToLL_M125_pow_ext1'],
    ['ZH_HToBB_ZToLL_M125_13TeV_powheg_pythia8_CUETP8M1Down'],
    ['ZH_HToBB_ZToLL_M125_13TeV_powheg_pythia8_CUETP8M1Up']]

decorrelate_sys_weight = {
    'CMS_LHE_weights_scale_muR_ZH':['ZH'],
    'CMS_LHE_weights_scale_muR_ggZH':['ggZH'],
    'CMS_LHE_weights_scale_muR_TT':['TT'],
    'CMS_LHE_weights_scale_muR_Zj0b':['ZJets_0b'],
    'CMS_LHE_weights_scale_muR_Zj1b':['ZJets_1b'],
    'CMS_LHE_weights_scale_muR_Zj2b':['ZJets_2b'],
    'CMS_LHE_weights_scale_muR_VVHF':['VVHF'],
    'CMS_LHE_weights_scale_muR_VVLF':['VVLF'],
    'CMS_LHE_weights_scale_muF_ZH':['ZH'],
    'CMS_LHE_weights_scale_muF_ggZH':['ggZH'],
    'CMS_LHE_weights_scale_muF_TT':['TT'],
    'CMS_LHE_weights_scale_muF_Zj0b':['ZJets_0b'],
    'CMS_LHE_weights_scale_muF_Zj1b':['ZJets_1b'],
    'CMS_LHE_weights_scale_muF_Zj2b':['ZJets_2b'],
    'CMS_LHE_weights_scale_muF_VVHF':['VVHF'],
    'CMS_LHE_weights_scale_muF_VVLF':['VVLF'],
    'CMS_vhbb_vjetnlodetajjrw_13TeV':['ZJets_0b','ZJets_1b','ZJets_2b'],
    'CMS_vhbb_vjetnlodetajjrw_13TeV_Zj0b':['ZJets_0b'],
    'CMS_vhbb_vjetnlodetajjrw_13TeV_Zj1b':['ZJets_1b'],
    'CMS_vhbb_vjetnlodetajjrw_13TeV_Zj2b':['ZJets_2b'],
    'CMS_vhbb_signal_ewk_13TeV':['ZH'],
    'CMS_vhbb_topptreweighting_13TeV': ['TT','ST'],
    }
sys_cut_include = []

#!! --------------------------------------
##!! Options
##!! --------------------------------------
#!! rescale stat shapes by sqrtN
rescaleSqrtN: False
#!! blind Data
blind: True
;blind: False 
#!! toy Data
toy: False
#! bin-by-bin statistics (sqrtN doesn't apply). Put False for CR/True for BDT
;(Defined above)
binstat: True
;binstat: False
#!! no stat shapes at all: Put True for CR/False for BDT
;(Defined above)
ignore_stats: False
;ignore_stats: True
#!! inject signal, e.g. ZH125 (working?)
signal_inject: False
#!! add signal als BKG, e.g. ZH125 (working?)
add_signal_as_bkg: None


;!! --------------------------------------
;#!! Samples
;#!! --------------------------------------
;#!! Datacard samples setup (1st Signal, afterwards BKG)

;VH
setup: ['ZH','ggZH','ZJets_0b','ZJets_1b','ZJets_2b','TT','VVLF','VVHF','ST']
setupSignals: ['ZH','ggZH']

Group = <!VHbbCommon|Group!> 

#!! --------------------------------------
#!! Naming
#!! --------------------------------------
#!! naming of processes in the DC
Dict = <!VHbbCommon|Dict!> 
systematicsnaming = <!VHbbCommon|systematicsnaming!> 

removeWeightSystematics = {'Zee': ['CMS_vhbb_eff_m_13TeV', 'CMS_vhbb_eff_m_trigger_Zll_13TeV', 'CMS_vhbb_eff_m_MVAID_Zll_13TeV', 'CMS_vhbb_eff_m_tracker_Zll_13TeV', 'CMS_vhbb_eff_m_ISO_Zll_13TeV'],
 'Zuu': ['CMS_vhbb_eff_e_13TeV', 'CMS_vhbb_eff_e_trigger_Zll_13TeV', 'CMS_vhbb_eff_e_MVAID_Zll_13TeV', 'CMS_vhbb_eff_e_MVAID_Zll_eta0_13TeV', 'CMS_vhbb_eff_e_MVAID_Zll_eta1_13TeV', 'CMS_vhbb_eff_e_tracker_Zll_13TeV']}

ptRegionsDict = {
                    'HighPt': ['HighPt', 'MJJ'],
                    'LowPt': ['lowPt'],
                }

;CR+SR
List: Zuu_CRZlight_lowpt,Zuu_CRZlight_highpt,Zee_CRZlight_lowpt,Zee_CRZlight_highpt,Zuu_CRZb_highpt,Zuu_CRZb_lowpt,Zee_CRZb_highpt,Zee_CRZb_lowpt,Zee_CRttbar_highpt,Zee_CRttbar_lowpt,Zuu_CRttbar_highpt,Zuu_CRttbar_lowpt,Zee_BDT_lowpt,Zee_BDT_highpt,Zuu_BDT_lowpt,Zuu_BDT_highpt

;;!! --------------------------------------
;;!! Datacards specific setup
;;!! --------------------------------------

;;List here the lnN sys in use
[Datacard]
rateParamRange = [0.2, 5.0]

;_*_*_*_*_*_*_*_*_*_*_*
;Systematics
;_*_*_*_*_*_*_*_*_*_*_*

InUseCommon = ['lumi_13TeV', 'pdf_qqbar', 'pdf_gg', 'QCDscale_VH', 'QCDscale_ttbar', 'QCDscale_VV', 'CMS_vhbb_boost_EWK_13TeV', 'CMS_vhbb_boost_QCD_13TeV', 'CMS_vhbb_ST', 'CMS_vhbb_VV','CMS_vhbb_LHE_weights_pdf_ZH','CMS_vhbb_LHE_weights_pdf_TT', 'CMS_vhbb_LHE_weights_pdf_Zj0b', 'CMS_vhbb_LHE_weights_pdf_Zj1b', 'CMS_vhbb_LHE_weights_pdf_Zj2b', 'CMS_vhbb_LHE_weights_pdf_VVHF', 'CMS_vhbb_LHE_weights_pdf_VVLF','CMS_vhbb_eff_m_trigger_Zll_13TeV']
InUseCommon_HighPt = <!Datacard|InUseCommon!>
InUseCommon_LowPt = <!Datacard|InUseCommon!>
InUseSF = []
InUse_BDT_NoSysRegion = <!Datacard|InUseCommon!> + <!Datacard|InUseSF!>
InUse_cr_NoSysRegion = <!Datacard|InUseCommon!> + <!Datacard|InUseSF!>
; + ['QCDscale_VH_ggZHacceptance_highPt'] + ['QCDscale_VH_ggZHacceptance_lowPt']
;For category bdt
InUse_BDT_HighPt = <!Datacard|InUseCommon_HighPt!> + ['QCDscale_VH_ggZHacceptance_highPt']
InUse_BDT_LowPt = <!Datacard|InUseCommon_LowPt!> + ['QCDscale_VH_ggZHacceptance_lowPt']
;InUse_BDT_HighPt = <!Datacard|InUse_BDT_NoSysRegion!> + ['QCDscale_VH_ggZHacceptance_highPt']
;InUse_BDT_LowPt = <!Datacard|InUse_BDT_NoSysRegion!> + ['QCDscale_VH_ggZHacceptance_lowPt']
InUse_cr_HighPt= <!Datacard|InUseCommon_HighPt!> + ['QCDscale_VH_ggZHacceptance_highPt']
InUse_cr_LowPt= <!Datacard|InUseCommon_LowPt!> + ['QCDscale_VH_ggZHacceptance_lowPt']

;For Mass s/(s+b)
InUse_mjj_LowPt= <!Datacard|InUseCommon_LowPt!> + ['QCDscale_VH_ggZHacceptance_lowPt']
InUse_mjj_HighPt= <!Datacard|InUseCommon_HighPt!> + ['QCDscale_VH_ggZHacceptance_highPt']

;For Mass analysis
InUse_mjj_bin0 = <!Datacard|InUseCommon_LowPt!> + ['QCDscale_VH_ggZHacceptance_lowPt']
InUse_mjj_bin1 = <!Datacard|InUseCommon_LowPt!> + ['QCDscale_VH_ggZHacceptance_lowPt']
InUse_mjj_bin2 = <!Datacard|InUseCommon_HighPt!> + ['QCDscale_VH_ggZHacceptance_highPt']

InUse_mjj_bin150To200 =   <!Datacard|InUseCommon_HighPt!> + ['QCDscale_VH_ggZHacceptance_highPt']
InUse_mjj_bin200ToInf =   <!Datacard|InUseCommon_HighPt!> + ['QCDscale_VH_ggZHacceptance_highPt']


rateParams = ['SF_TT','SF_Zj0b','SF_Zjb','SF_Zj2b']
rateParams_BDT_HighPt =  ['SF_TT_high_Zll','SF_Zj0b_high_Zll','SF_Zjb_high_Zll','SF_Zj2b_high_Zll']
rateParams_BDT_LowPt =  ['SF_TT_low_Zll','SF_Zj0b_low_Zll','SF_Zjb_low_Zll','SF_Zj2b_low_Zll']
rateParams_BDT_NoSysRegion = <!Datacard|rateParams!>
rateParams_cr_NoSysRegion = <!Datacard|rateParams!>
rateParams_cr_HighPt = ['SF_TT_high_Zll','SF_Zj0b_high_Zll','SF_Zjb_high_Zll','SF_Zj2b_high_Zll']
rateParams_cr_LowPt = ['SF_TT_low_Zll','SF_Zj0b_low_Zll','SF_Zjb_low_Zll','SF_Zj2b_low_Zll']

;For Mass s/(s+b)
rateParams_mjj_HighPt = ['SF_TT_norm_high_Zll','SF_Zj0b_norm_high_Zll','SF_Zjb_norm_high_Zll','SF_Zj2b_norm_high_Zll']
rateParams_mjj_LowPt = ['SF_TT_norm_low_Zll','SF_Zj0b_norm_low_Zll','SF_Zjb_norm_low_Zll','SF_Zj2b_norm_low_Zll']
;For Mass analysis
rateParams_mjj_bin0 = ['SF_TT_low_Zll','SF_Zj0b_low_Zll','SF_Zjb_low_Zll','SF_Zj2b_low_Zll']
rateParams_mjj_bin1 = ['SF_TT_low_Zll','SF_Zj0b_low_Zll','SF_Zjb_low_Zll','SF_Zj2b_low_Zll']
rateParams_mjj_bin2 = ['SF_TT_high_Zll','SF_Zj0b_high_Zll','SF_Zjb_high_Zll','SF_Zj2b_high_Zll']

rateParams_mjj_bin150To200 =  ['SF_TT_high_Zll','SF_Zj0b_high_Zll','SF_Zjb_high_Zll','SF_Zj2b_high_Zll']
rateParams_mjj_bin200ToInf =  ['SF_TT_high_Zll','SF_Zj0b_high_Zll','SF_Zjb_high_Zll','SF_Zj2b_high_Zll']

;!! ---------------
;!! Sys definitions
;!! ---------------
;!!!Do not put Groups but same elements as in setup

;the systematic on luminosity is around 2% for all samples NOT data driven: ggZH, ZH, WH, VV, ST, QCD
lumi_13TeV =  {'type':'lnN', 'ggZH':1.023, 'ZH':1.023, 'ZJets_0b':1.023, 'Zb':1.023, 'Zbb':1.023, 'TT':1.023, 'ST':1.023,'VVLF':1.023,'VVHF':1.023,'VV':1.023}
lumi_13TeV_low = <!Datacard|lumi_13TeV!>
lumi_13TeV_high = <!Datacard|lumi_13TeV!>

;the systematic on qq PDF is around 1% for all samples NOT data driven and generate by qq: ZH, WH, VV, ST
pdf_qqbar = {'type':'lnN', 'ZH':1.023,'VVLF':1.01,'VVHF':1.01, 'ZJets_0b':1.01, 'Zb':1.01, 'Zbb':1.01, 'VV': 1.01}
pdf_qqbar_low = <!Datacard|pdf_qqbar!>
pdf_qqbar_high = <!Datacard|pdf_qqbar!>

;the systematic on qq PDF is around 1% for all samples NOT data driven and generate by gg: ggZH, ST, QCD
pdf_gg = {'type':'lnN', 'ggZH':1.02,'ST':1.01,'QCD':1.01, 'TT':1.01}
pdf_gg_low = <!Datacard|pdf_gg!>
pdf_gg_high = <!Datacard|pdf_gg!>

QCDscale_VH = {'type':'lnN','ZH':1.04}
QCDscale_VH_low = <!Datacard|QCDscale_VH!>
QCDscale_VH_high = <!Datacard|QCDscale_VH!>
QCDscale_ttbar = {'type':'lnN', 'TT':1.06}
QCDscale_ttbar_low = <!Datacard|QCDscale_ttbar!>
QCDscale_ttbar_high = <!Datacard|QCDscale_ttbar!>
QCDscale_VV = {'type':'lnN', 'VVLF':1.04,'VVHF':1.04, 'VV':1.04}
QCDscale_VV_low = <!Datacard|QCDscale_VV!>
QCDscale_VV_high = <!Datacard|QCDscale_VV!>

CMS_vhbb_boost_EWK_13TeV = {'type':'lnN','ggZH':1.02}
CMS_vhbb_boost_EWK_13TeV_low = <!Datacard|CMS_vhbb_boost_EWK_13TeV!>
CMS_vhbb_boost_EWK_13TeV_high = <!Datacard|CMS_vhbb_boost_EWK_13TeV!>

CMS_vhbb_boost_QCD_13TeV = {'type':'lnN','ggZH':1.05}
CMS_vhbb_boost_QCD_13TeV_low = <!Datacard|CMS_vhbb_boost_QCD_13TeV!>
CMS_vhbb_boost_QCD_13TeV_high = <!Datacard|CMS_vhbb_boost_QCD_13TeV!>

CMS_vhbb_ST = {'type':'lnN', 'ST':1.15}
CMS_vhbb_ST_low = <!Datacard|CMS_vhbb_ST!>
CMS_vhbb_ST_high= <!Datacard|CMS_vhbb_ST!>

CMS_vhbb_VV = {'type':'lnN', 'VVLF':1.15,'VVHF':1.15,'VV':1.15}
CMS_vhbb_VV_low = <!Datacard|CMS_vhbb_VV!>
CMS_vhbb_VV_high= <!Datacard|CMS_vhbb_VV!>

CMS_vhbb_ZJets_0b_SF_Zll_13TeV = {'type':'lnN', 'ZJets_0b':1.013}
CMS_vhbb_ZJets_0b_SF_Zll_13TeV_low = <!Datacard|CMS_vhbb_ZJets_0b_SF_Zll_13TeV!>
CMS_vhbb_ZJets_0b_SF_Zll_13TeV_high = <!Datacard|CMS_vhbb_ZJets_0b_SF_Zll_13TeV!>

CMS_vhbb_Zjb_SF_Zll_13TeV = {'type':'lnN', 'Zb':1.054,'Zbb':1.054}
CMS_vhbb_Zjb_SF_Zll_13TeV_low = <!Datacard|CMS_vhbb_Zjb_SF_Zll_13TeV!>
CMS_vhbb_Zjb_SF_Zll_13TeV_high = <!Datacard|CMS_vhbb_Zjb_SF_Zll_13TeV!>

CMS_vhbb_TT_SF_Zll_13TeV = {'type':'lnN', 'TT':1.032}
CMS_vhbb_TT_SF_Zll_13TeV_low = <!Datacard|CMS_vhbb_TT_SF_Zll_13TeV!>
CMS_vhbb_TT_SF_Zll_13TeV_high = <!Datacard|CMS_vhbb_TT_SF_Zll_13TeV!>

CMS_vhbb_QCD_SF_Zll_13TeV = {'type':'lnN', 'QCD':1.04}
CMS_vhbb_QCD_SF_Zll_13TeV_low = <!Datacard|CMS_vhbb_QCD_SF_Zll_13TeV!>
CMS_vhbb_QCD_SF_Zll_13TeV_high = <!Datacard|CMS_vhbb_QCD_SF_Zll_13TeV!>

CMS_vhbb_eff_lep_13TeV = {'type':'lnN', 'ZH':1.05, 'ggZH':1.05, 'ZJets_0b':1.05, 'Zb':1.05, 'Zbb':1.05, 'TT':1.05,'ZH':1.05, 'ST':1.05,'VVLF':1.05,'VVHF':1.05,'VV':1.05}
CMS_vhbb_eff_e_13TeV = {'type':'lnN', 'ZH':1.05, 'ggZH':1.05, 'ZJets_0b':1.05, 'Zb':1.05, 'Zbb':1.05, 'TT':1.05,'ZH':1.05, 'ST':1.05,'VVLF':1.05,'VVHF':1.05,'VV':1.05}
CMS_vhbb_eff_m_13TeV = {'type':'lnN', 'ZH':1.05, 'ggZH':1.05, 'ZJets_0b':1.05, 'Zb':1.05, 'Zbb':1.05, 'TT':1.05,'ZH':1.05, 'ST':1.05,'VVLF':1.05,'VVHF':1.05,'VV':1.05}
CMS_vhbb_eff_lep_13TeV_low = <!Datacard|CMS_vhbb_eff_lep_13TeV!>
CMS_vhbb_eff_e_13TeV_low = <!Datacard|CMS_vhbb_eff_e_13TeV!>
CMS_vhbb_eff_lep_13TeV_high = <!Datacard|CMS_vhbb_eff_lep_13TeV!>
CMS_vhbb_eff_m_13TeV_high = <!Datacard|CMS_vhbb_eff_m_13TeV!>
;split lep sf
CMS_vhbb_eff_e_trigger_Zll_13TeV = <!Datacard|CMS_vhbb_eff_e_13TeV!>
CMS_vhbb_eff_e_MVAID_Zll_13TeV = <!Datacard|CMS_vhbb_eff_e_13TeV!>
CMS_vhbb_eff_e_MVAID_Zll_eta0_13TeV = <!Datacard|CMS_vhbb_eff_e_13TeV!>
CMS_vhbb_eff_e_MVAID_Zll_eta1_13TeV = <!Datacard|CMS_vhbb_eff_e_13TeV!>
;CMS_vhbb_eff_e_tracker_Zll_13TeV = <!Datacard|CMS_vhbb_eff_e_13TeV!>
;split lep sf
CMS_vhbb_eff_m_trigger_Zll_13TeV = {'type':'lnN', 'ZH':1.04, 'ggZH':1.04, 'ZJets_0b':1.04, 'Zb':1.04, 'Zbb':1.04, 'TT':1.04,'ZH':1.04, 'ST':1.04,'VVLF':1.04,'VVHF':1.04,'VV':1.04} 
CMS_vhbb_eff_m_MVAID_Zll_13TeV = <!Datacard|CMS_vhbb_eff_m_13TeV!>
;CMS_vhbb_eff_m_tracker_Zll_13TeV = <!Datacard|CMS_vhbb_eff_m_13TeV!>
CMS_vhbb_eff_m_ISO_Zll_13TeV = <!Datacard|CMS_vhbb_eff_m_13TeV!>

CMS_vhbb_LHE_weights_pdf_ZH = {'type':'lnN', 'ZH':1.01}
CMS_vhbb_LHE_weights_pdf_TT = {'type':'lnN', 'TT':1.005}
CMS_vhbb_LHE_weights_pdf_Zj0b = {'type':'lnN', 'ZJets_0b':1.05}
CMS_vhbb_LHE_weights_pdf_Zj1b = {'type':'lnN', 'Zb':1.03}
CMS_vhbb_LHE_weights_pdf_Zj2b = {'type':'lnN', 'Zbb':1.02}
CMS_vhbb_LHE_weights_pdf_VVHF = {'type':'lnN', 'VVLF':1.02}
CMS_vhbb_LHE_weights_pdf_VVLF = {'type':'lnN', 'VVHF':1.03}

QCDscale_VH_ggZHacceptance_lowPt = {'type':'lnN', 'ggZH':1.32}
QCDscale_VH_ggZHacceptance_highPt = {'type':'lnN', 'ggZH':1.32}

SF_TT   = {'TT':1}
SF_Zj0b  = {'Zj0b':1}
SF_Zjb  = {'Zj1b':1}
SF_Zj2b  = {'Zj2b':1}

SF_TT_norm_high_Zll   = {'TT':1}
SF_Zj0b_norm_high_Zll  = {'Zj0b':1}
SF_Zjb_norm_high_Zll  = {'Zj1b':1}
SF_Zj2b_norm_high_Zll  = {'Zj2b':1}
SF_Zjnb_norm_high_Zll  = {'Zj1b':1,'Zj2b':1}

SF_TT_norm_low_Zll   = {'TT':1}
SF_Zj0b_norm_low_Zll  = {'Zj0b':1}
SF_Zjb_norm_low_Zll  = {'Zj1b':1}
SF_Zj2b_norm_low_Zll  = {'Zj2b':1}
SF_Zjnb_norm_low_Zll  = {'Zj1b':1,'Zj2b':1}

SF_TT_high_Zll   = {'TT':1}
SF_Zj0b_high_Zll  = {'Zj0b':1}
SF_Zjb_high_Zll  = {'Zj1b':1}
SF_Zj2b_high_Zll  = {'Zj2b':1}
SF_Zjnb_high_Zll  = {'Zj1b':1,'Zj2b':1}

SF_TT_low_Zll   = {'TT':1}
SF_Zj0b_low_Zll  = {'Zj0b':1}
SF_Zjb_low_Zll  = {'Zj1b':1}
SF_Zj2b_low_Zll  = {'Zj2b':1}
SF_Zjnb_low_Zll  = {'Zj1b':1,'Zj2b':1}

#!! -------------------------
#!! Limit definitions
#!! -------------------------

;======================
;For SF fit (CR+SF)
;======================


;;Default
;VHsignals = <!Plot_general|allSIG!>
;VHbackgrounds = [<!Plot_general|allBKG!>]
;VVsignals = <!Plot_general|allSIGVV!>
;VVbackgrounds = [<!Plot_general|allBKGVV!>]

;
;VHsignals = <!Plot_general|allSIG!>
;VHsignals = <!Plot_general|allSIG!>
VHsignals = [<!Plot_general|allSIG!>]
;,<!Plot_general|sigVHPS!>]
VHbackgrounds = [<!Plot_general|allBKG!>]
VVsignals = [<!Plot_general|allSIGVV!>]
VVbackgrounds = [<!Plot_general|allBKGVV!>]

DNNbinsV2 = [0.0, 0.0241127, 0.0760807, 0.162694, 0.283952, 0.43978, 0.623928, 0.766418, 0.835969, 0.876401, 0.904422, 0.925809, 0.943104, 0.957631, 0.970163, 1.0]
DNNbinsV3 = [0, 0.028937176736545563, 0.08034977150591611, 0.1660374937206507, 0.285999861387372, 0.44016158714056014, 0.6223415879108906, 0.7633092269563675, 0.8321176374999285, 0.8721173038877249, 0.8998386709845067, 0.9209972162572145, 0.9381070171613693, 0.9524790956829786, 0.964876929331541, 1.0]
DNNbinsV3low = [0, 0.024218213729900122, 0.0763223967867136, 0.16316276701167226, 0.2847388359277546, 0.44097430342420935, 0.6256049401778877, 0.7684688376890123, 0.8382028403179944, 0.8787405713745653, 0.9068348387865722, 0.9282780030744374, 0.9456179603820741, 0.9601833682078421, 0.9727479741537273, 1.0]
DNNbins2016 = [0.0, 0.0233372, 0.0763686, 0.164754, 0.288494, 0.44751, 0.635427, 0.780833, 0.851807, 0.893066, 0.921661, 0.943485, 0.961134, 0.975959, 0.988747, 1.0] 
DNNbinsV4 = [0, 0.023502123926115035, 0.0761406185793221, 0.1638715087994933, 0.28669430110043287, 0.4445319129383564, 0.6310558773382902, 0.7753847980523109, 0.8458339003927112, 0.8867873328099847, 0.9151696978753805, 0.936832754898727, 0.9543505278773308, 0.9690652992637753, 0.9817587511922121, 1.0]
DNNbinsV4low = [0, 0.02091579725115895, 0.07361567352392077, 0.161448866520077, 0.2844148821779787, 0.44243654806807636, 0.6291780176055729, 0.7736752399201691, 0.8442064927860797, 0.8852076809004843, 0.9136231425721943, 0.9353114608332217, 0.9528496612439453, 0.9675815914892256, 0.980289845220834, 1.0]

DNNbinsLowPt  = <!Datacard|DNNbinsV4low!>
DNNbinsHighPt = <!Datacard|DNNbinsV4!>

DNNbinsLowPt2016  = <!Datacard|DNNbins2016!>
DNNbinsHighPt2016 = <!Datacard|DNNbins2016!>

;;;;;;;;;;;;;;
;VH datacards
;;;;;;;;;;;;;;

;ELECTRON REGION

;low pt
[dc:Zee_CRZlight_lowpt]
var = <!LimitGeneral|normVar!>
range = <!LimitGeneral|normRange!>
dcName = Zee_CRZlight_lowpt
cut = Zee_CRZlight_lowpt
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = Zee_CRZlight_lowpt
data = <!Plot_general|eData!>
type= cr
wsVarName = Zee_CRZlight_lowpt
[dc:Zee_CRZb_lowpt]
var = <!LimitGeneral|bTagVar!>
range = <!LimitGeneral|bTagVarRange!>
dcName = Zee_CRZb_lowpt
cut = Zee_CRZb_lowpt
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = Zee_CRZb_lowpt
data = <!Plot_general|eData!>
type= cr
wsVarName = Zee_CRZb_lowpt
[dc:Zee_CRttbar_lowpt]
var = <!LimitGeneral|normVar!>
range = <!LimitGeneral|normRange!>
dcName = Zee_CRttbar_lowpt
cut = Zee_CRttbar_lowpt
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = Zee_CRttbar_lowpt
data = <!Plot_general|eData!>
type= cr
wsVarName = Zee_CRttbar_lowpt
[dc:Zee_BDT_lowpt]
var = <!LimitGeneral|BDTlow!>
range = <!LimitGeneral|BDTrange!>
dcName = Zee_BDT_lowpt
cut = Zee_BDT_lowpt
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = Zee_BDT_lowpt
data = <!Plot_general|eData!>
type= BDT
wsVarName = Zee_BDT_lowpt
rebin_method = fixed
rebin_list = <!Datacard|DNNbinsLowPt!> 


;high pt

[dc:Zee_CRZlight_highpt]
var = <!LimitGeneral|normVar!>
range = <!LimitGeneral|normRange!>
dcName = Zee_CRZlight_highpt
cut = Zee_CRZlight_highpt
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = Zee_CRZlight_highpt
data = <!Plot_general|eData!>
type= cr
wsVarName = Zee_CRZlight_highpt
[dc:Zee_CRZb_highpt]
var = <!LimitGeneral|bTagVar!>
range = <!LimitGeneral|bTagVarRange!>
dcName = Zee_CRZb_highpt
cut = Zee_CRZb_highpt
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = Zee_CRZb_highpt
data = <!Plot_general|eData!>
type= cr
wsVarName = Zee_CRZb_highpt
[dc:Zee_CRttbar_highpt]
var = <!LimitGeneral|normVar!>
range = <!LimitGeneral|normRange!>
dcName = Zee_CRttbar_highpt
cut = Zee_CRttbar_highpt
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = Zee_CRttbar_highpt
data = <!Plot_general|eData!>
type= cr
wsVarName = Zee_CRttbar_highpt
[dc:Zee_BDT_highpt]
var = <!LimitGeneral|BDThigh!>
range = <!LimitGeneral|BDTrange!>
;var = <!LimitGeneral|Mass!>
;range = <!LimitGeneral|MassRange!>
dcName = Zee_BDT_highpt
cut = Zee_BDT_highpt
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = Zee_BDT_highpt
data = <!Plot_general|eData!>
type= BDT
wsVarName = Zee_BDT_highpt
rebin_method = fixed
rebin_list = <!Datacard|DNNbinsHighPt!>

;Mass
[dc:ZeeMass_highpt]
var = <!LimitGeneral|Mass!>
range = <!LimitGeneral|MassRange!>
dcName = ZeeMass_highpt
cut = ZeeBDT_highpt_M
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = ZeeMass_highpt
data = <!Plot_general|eData!>
type= mjj
;SBweight = sb_weight_ZeeBDTVH_highpt
SBweight = VHbb::SoverSBWeight(ZllBDT_highptCMVA.Nominal,3)
wsVarName = ZeeMass_highpt
[dc:ZeeHighPt_13TeV]
var = <!LimitGeneral|Mass!>
range = <!LimitGeneral|MassRange!>
dcName = ZeeHighPt_13TeV
cut = ZeeBDT_highpt_M
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = ZeeHighPt_13TeV
data = <!Plot_general|eData!>
type= mjj
;SBweight = sb_weight_ZeeBDTVH_highpt
;SBweight = VHbb::SoverSBWeight(ZllBDT_highptCMVA.Nominal,3)
wsVarName = ZeeHighPt_13TeV

;MUON REGION

;low pt
[dc:Zuu_CRZlight_lowpt]
var = <!LimitGeneral|normVar!>
range = <!LimitGeneral|normRange!>
dcName = Zuu_CRZlight_lowpt
cut = Zuu_CRZlight_lowpt
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = Zuu_CRZlight_lowpt
data = <!Plot_general|muData!>
type= cr
wsVarName = Zuu_CRZlight_lowpt
[dc:Zuu_CRZb_lowpt]
var = <!LimitGeneral|bTagVar!>
range = <!LimitGeneral|bTagVarRange!>
dcName = Zuu_CRZb_lowpt
cut = Zuu_CRZb_lowpt
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = Zuu_CRZb_lowpt
data = <!Plot_general|muData!>
type= cr
wsVarName = Zuu_CRZb_lowpt
[dc:Zuu_CRttbar_lowpt]
var = <!LimitGeneral|normVar!>
range = <!LimitGeneral|normRange!>
dcName = Zuu_CRttbar_lowpt
cut = Zuu_CRttbar_lowpt
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = Zuu_CRttbar_lowpt
data = <!Plot_general|muData!>
type= cr
wsVarName = Zuu_CRttbar_lowpt
[dc:Zuu_BDT_lowpt]
var = <!LimitGeneral|BDTlow!>
range = <!LimitGeneral|BDTrange!>
;var = <!LimitGeneral|Mass!>
;range = <!LimitGeneral|MassRange!>
dcName = Zuu_BDT_lowpt
cut = Zuu_BDT_lowpt
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = Zuu_BDT_lowpt
data = <!Plot_general|muData!>
type= BDT
wsVarName = Zuu_BDT_lowpt
rebin_method = fixed
rebin_list = <!Datacard|DNNbinsLowPt!>

;Mass
[dc:ZuuMass_lowpt]
var = <!LimitGeneral|Mass!>
range = <!LimitGeneral|MassRange!>
dcName = ZuuMass_lowpt
cut = ZuuBDT_lowpt_M
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = ZuuMass_lowpt
data = <!Plot_general|muData!>
type= mjj
;SBweight = sb_weight_ZuuBDTVH_lowpt
SBweight = VHbb::SoverSBWeight(ZllBDT_lowptCMVA.Nominal,2)
wsVarName = ZuuMass_lowpt
[dc:ZuuLowPt_13TeV]
var = <!LimitGeneral|Mass!>
range = <!LimitGeneral|MassRange!>
dcName = ZuuLowPt_13TeV
cut = ZuuBDT_lowpt_M
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = ZuuLowPt_13TeV
data = <!Plot_general|muData!>
type= mjj
;SBweight = sb_weight_ZuuBDTVH_lowpt
;SBweight = VHbb::SoverSBWeight(ZllBDT_lowptCMVA.Nominal,2)
wsVarName = ZuuLowPt_13TeV

;high pt

[dc:Zuu_CRZlight_highpt]
var = <!LimitGeneral|normVar!>
range = <!LimitGeneral|normRange!>
dcName = Zuu_CRZlight_highpt
cut = Zuu_CRZlight_highpt
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = Zuu_CRZlight_highpt
data = <!Plot_general|muData!>
type= cr
wsVarName = Zuu_CRZlight_highpt
[dc:Zuu_CRZb_highpt]
var = <!LimitGeneral|bTagVar!>
range = <!LimitGeneral|bTagVarRange!>
dcName = Zuu_CRZb_highpt
cut = Zuu_CRZb_highpt
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = Zuu_CRZb_highpt
data = <!Plot_general|muData!>
type= cr
wsVarName = Zuu_CRZb_highpt
[dc:Zuu_CRttbar_highpt]
var = <!LimitGeneral|normVar!>
range = <!LimitGeneral|normRange!>
dcName = Zuu_CRttbar_highpt
cut = Zuu_CRttbar_highpt
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = Zuu_CRttbar_highpt
data = <!Plot_general|muData!>
type= cr
wsVarName = Zuu_CRttbar_highpt
[dc:Zuu_BDT_highpt]
var = <!LimitGeneral|BDThigh!>
range = <!LimitGeneral|BDTrange!>
;var = <!LimitGeneral|Mass!>
;range = <!LimitGeneral|MassRange!>
dcName = Zuu_BDT_highpt
cut = Zuu_BDT_highpt
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = Zuu_BDT_highpt
data = <!Plot_general|muData!>
type= BDT
wsVarName = Zuu_BDT_highpt
rebin_method = fixed
rebin_list = <!Datacard|DNNbinsHighPt!>

;Mass
[dc:ZuuMass_highpt]
var = <!LimitGeneral|Mass!>
range = <!LimitGeneral|MassRange!>
dcName = ZuuMass_highpt
cut = ZuuBDT_highpt_M
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = ZuuMass_highpt
data = <!Plot_general|muData!>
type= mjj
;SBweight = sb_weight_ZuuBDTVH_highpt
SBweight = VHbb::SoverSBWeight(ZllBDT_highptCMVA.Nominal,4)
wsVarName = ZuuMass_highpt

[dc:ZuuHighPt_13TeV]
var = <!LimitGeneral|Mass!>
range = <!LimitGeneral|MassRange!>
dcName = ZuuHighPt_13TeV
cut = ZuuBDT_highpt_M
signal = <!Datacard|VHsignals!>
background = <!Datacard|VHbackgrounds!>
dcBin = ZuuHighPt_13TeV
data = <!Plot_general|muData!>
type= mjj
;SBweight = sb_weight_ZuuBDTVH_highpt
;SBweight = VHbb::SoverSBWeight(ZllBDT_highptCMVA.Nominal,4)
wsVarName = ZuuHighPt_13TeV

;;;;
;VV
;;;;

;ELECTRON REGION

;CR
[dc:Zee_CRZb_inclVV_lowpt]
var = <!LimitGeneral|bTagVar!>
range = <!LimitGeneral|bTagVarRange!>
dcName = Zee_CRZb_inclVV_lowpt
cut = Zee_CRZb_inclVV_lowpt
background = <!Datacard|VVbackgrounds!>
signal = <!Datacard|VVsignals!>
dcBin = Zee_CRZb_inclVV_lowpt
data =  <!Plot_general|eData!>
type= cr
wsVarName = Zee_CRZb_inclVV_lowpt
[dc:Zee_CRZb_inclVV_highpt]
var = <!LimitGeneral|bTagVar!>
range = <!LimitGeneral|bTagVarRange!>
dcName = Zee_CRZb_inclVV_highpt
cut = Zee_CRZb_inclVV_highpt
background = <!Datacard|VVbackgrounds!>
signal = <!Datacard|VVsignals!>
dcBin = Zee_CRZb_inclVV_highpt
data =  <!Plot_general|eData!>
type= cr
wsVarName = Zee_CRZb_inclVV_highpt
;SR
[dc:ZeeBDTVV_lowpt]
var = <!LimitGeneral|BDTVVlow!>
range = <!LimitGeneral|BDTrange!>
dcName = ZeeBDTVV_lowpt
cut = ZeeBDTVV_lowpt
background = <!Datacard|VVbackgrounds!>
signal = <!Datacard|VVsignals!>
dcBin = ZeeBDTVV_lowpt
data =  <!Plot_general|eData!>
type= BDT
wsVarName = ZeeBDTVV_lowpt
;mass
[dc:ZeeMassVV_lowpt]
var = <!LimitGeneral|Mass!>
range = <!LimitGeneral|MassRangeVV!>
dcName = ZeeMassVV_lowpt
cut = ZeeBDTVV_lowpt_M
background = <!Datacard|VVbackgrounds!>
signal = <!Datacard|VVsignals!>
dcBin = ZeeMassVV_lowpt
data =  <!Plot_general|eData!>
type= mjj
SBweight = sb_weight_ZeeBDT_lowpt
wsVarName = ZeeMassVV_lowpt
[dc:ZeeBDTVV_highpt]
var = <!LimitGeneral|BDTVVhigh!>
range = <!LimitGeneral|BDTrange!>
dcName = ZeeBDTVV_highpt
cut = ZeeBDTVV_highpt
background = <!Datacard|VVbackgrounds!>
signal = <!Datacard|VVsignals!>
dcBin = ZeeBDTVV_highpt
data =  <!Plot_general|eData!>
type= BDT
wsVarName = ZeeBDTVV_highpt
;mass
[dc:ZeeMassVV_highpt]
var = <!LimitGeneral|Mass!>
range = <!LimitGeneral|MassRangeVV!>
dcName = ZeeMassVV_highpt
cut = ZeeBDTVV_highpt_M
background = <!Datacard|VVbackgrounds!>
signal = <!Datacard|VVsignals!>
dcBin = ZeeMassVV_highpt
data =  <!Plot_general|eData!>
type=mjj
SBweight = sb_weight_ZeeBDT_highpt
wsVarName = ZeeMassVV_highpt

;MUON

;CR
[dc:Zuu_CRZb_inclVV_lowpt]
var = <!LimitGeneral|bTagVar!>
range = <!LimitGeneral|bTagVarRange!>
dcName = Zuu_CRZb_inclVV_lowpt
cut = Zuu_CRZb_inclVV_lowpt
background = <!Datacard|VVbackgrounds!>
signal = <!Datacard|VVsignals!>
dcBin = Zuu_CRZb_inclVV_lowpt
data =  <!Plot_general|muData!>
type= cr
wsVarName = Zuu_CRZb_inclVV_lowpt
[dc:Zuu_CRZb_inclVV_highpt]
var = <!LimitGeneral|bTagVar!>
range = <!LimitGeneral|bTagVarRange!>
dcName = Zuu_CRZb_inclVV_highpt
cut = Zuu_CRZb_inclVV_highpt
background = <!Datacard|VVbackgrounds!>
signal = <!Datacard|VVsignals!>
dcBin = Zuu_CRZb_inclVV_highpt
data =  <!Plot_general|muData!>
type= cr
wsVarName = Zuu_CRZb_inclVV_highpt
;SR
[dc:ZuuBDTVV_lowpt]
var = <!LimitGeneral|BDTVVlow!>
range = <!LimitGeneral|BDTrange!>
dcName = ZuuBDTVV_lowpt
cut = ZuuBDTVV_lowpt
background = <!Datacard|VVbackgrounds!>
signal = <!Datacard|VVsignals!>
dcBin = ZuuBDTVV_lowpt
data =  <!Plot_general|muData!>
type= BDT
wsVarName = ZuuBDTVV_lowpt
;mass
[dc:ZuuMassVV_lowpt]
var = <!LimitGeneral|Mass!>
range = <!LimitGeneral|MassRangeVV!>
dcName = ZuuMassVV_lowpt
cut = ZuuBDTVV_lowpt_M
background = <!Datacard|VVbackgrounds!>
signal = <!Datacard|VVsignals!>
dcBin = ZuuMassVV_lowpt
data =  <!Plot_general|muData!>
type=mjj
SBweight = sb_weight_ZuuBDT_lowpt
wsVarName = ZuuMassVV_lowpt
[dc:ZuuBDTVV_highpt]
var = <!LimitGeneral|BDTVVhigh!>
range = <!LimitGeneral|BDTrange!>
dcName = ZuuBDTVV_highpt
cut = ZuuBDTVV_highpt
background = <!Datacard|VVbackgrounds!>
signal = <!Datacard|VVsignals!>
dcBin = ZuuBDTVV_highpt
data =  <!Plot_general|muData!>
type= BDT
wsVarName = ZuuBDTVV_highpt
;mass
[dc:ZuuMassVV_highpt]
var = <!LimitGeneral|Mass!>
range = <!LimitGeneral|MassRangeVV!>
dcName = ZuuMassVV_highpt
cut = ZuuBDTVV_highpt_M
background = <!Datacard|VVbackgrounds!>
signal = <!Datacard|VVsignals!>
dcBin = ZuuMassVV_highpt
data =  <!Plot_general|muData!>
type=mjj
SBweight = sb_weight_ZuuBDT_highpt
wsVarName = ZuuMassVV_highpt
