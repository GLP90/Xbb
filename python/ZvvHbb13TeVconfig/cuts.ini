; TreeCuts:
[ZHbb]
;!! --------------------------------
;!! Variables and values definition
;!! --------------------------------
;# BTAG working points
;# https://twiki.cern.ch/twiki/bin/viewauth/CMS/BTagPerformanceOP
CSV_VeryLoose = 0.4
CSV_Loose = 0.605
CSV_Medium = 0.890
CSV_Tight = 0.970

;#See https://twiki.cern.ch/twiki/bin/viewauth/CMS/SWGuideMuonIdRun2#Muon_Isolation
VetoMuon = (Sum$(aLeptons_looseIdPOG>0 && aLeptons_pfRelIso04<0.50 && abs(aLeptons_pdgId)==13 && aLeptons_pt>5) + Sum$(vLeptons_looseIdPOG>0 && vLeptons_pfRelIso04<0.50 && abs(vLeptons_pdgId)==13 && vLeptons_pt>5))
TightMuon = (Sum$(aLeptons_tightId>0 && aLeptons_pfRelIso04<0.15 && abs(aLeptons_pdgId)==13 && aLeptons_pt>20) + Sum$(vLeptons_tightId>0 && vLeptons_pfRelIso04<0.15 && abs(vLeptons_pdgId)==13 && vLeptons_pt>20))

;#See https://twiki.cern.ch/twiki/bin/view/CMS/EgammaIDRecipesRun2 (in particular CutBasedElectronIdentificationRun2)
VetoElectron =  (Sum$(aLeptons_eleCutIdSpring15_25ns_v1>0 && aLeptons_pfRelIso04<0.50 && abs(aLeptons_pdgId)==11 && aLeptons_pt>5) + Sum$(vLeptons_eleCutIdSpring15_25ns_v1>0 && vLeptons_pfRelIso04<0.50 && abs(vLeptons_pdgId)==11 && vLeptons_pt>5))
TightElectron = (Sum$(aLeptons_eleCutIdSpring15_25ns_v1>3 && aLeptons_pfRelIso04<0.15 && abs(aLeptons_pdgId)==11 && aLeptons_pt>20) + Sum$(vLeptons_eleCutIdSpring15_25ns_v1>3 && vLeptons_pfRelIso04<0.15 && abs(vLeptons_pdgId)==11 && vLeptons_pt>20))

;#All muons pass already aLeptons_looseIdPOG

;#See https://twiki.cern.ch/twiki/bin/view/CMS/EgammaIDRecipesRun2

minBtag = min(Jet_btagCSV[hJCidx[0]],Jet_btagCSV[hJCidx[1]])
maxBtag = max(Jet_btagCSV[hJCidx[0]],Jet_btagCSV[hJCidx[1]])

addCenJet30 = (Sum$(Jet_pt>30 && abs(Jet_eta)<5.2)-2)
addCenJet20 = (Sum$(Jet_pt>20 && abs(Jet_eta)<5.2)-2)
VetoLeptons = (<!ZHbb|VetoMuon!> + <!ZHbb|VetoElectron!>)
TightLeptons = (<!ZHbb|TightMuon!> + <!ZHbb|TightElectron!>)
naddGoodLeptons5 = (<!ZHbb|VetoLeptons!>)

;naddGoodLeptons5 = (Sum$(aLeptons_pt>5 && (aLeptons_jetBTagCSV<0.25 || aLeptons_relIso03<0.4 || aLeptons_looseIdSusy!=0 ||  aLeptons_jetDR>0.3 ))+Sum$(vLeptons_pt>5 && (vLeptons_jetBTagCSV<0.25 || vLeptons_relIso03<0.4 || vLeptons_looseIdSusy!=0 ||  vLeptons_jetDR>0.3 )))

;!! --------------------------------
;!! Single variable cuts
;!! --------------------------------
tcBtag = <!ZHbb|maxBtag!> > <!ZHbb|CSVT!> & <!ZHbb|minBtag!> > <!ZHbb|CSVC!>
ccBtag = <!ZHbb|maxBtag!> > <!ZHbb|CSVC!> & <!ZHbb|minBtag!> > <!ZHbb|CSVC!>
tlBtag = <!ZHbb|maxBtag!> > <!ZHbb|CSVT!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!>
mcBtag = <!ZHbb|maxBtag!> > <!ZHbb|CSVM!> & <!ZHbb|minBtag!> > <!ZHbb|CSVC!>
ntBtag = !(Jet_btagCSV[hJCidx[0]] > <!ZHbb|CSVT!> | Jet_btagCSV[hJCidx[1]] > <!ZHbb|CSVT!>)
twoCSV0 = Jet_btagCSV[hJCidx[0]] > 0. & Jet_btagCSV[hJCidx[1]] > 0. 
30jets = Jet_pt[hJCidx[0]] > 30. & Jet_pt[hJCidx[1]] > 30.
noAddJet = Sum$(Jet_pt[aJidx] > 20 & abs(Jet_eta[aJidx]) < 2.4) == 0 
max1AddJet = Sum$(Jet_pt[aJidx] > 20 & abs(Jet_eta[aJidx]) < 2.4) < 2.
pullAngle = 1 < 10. & 1 < 10.
rLoose = V.pt < 50
rTight = V.pt > 100.
rTight2 = V.pt > 150.
rTight_120 = V.pt > 120.
rTight_150 = V.pt > 150.
rTight_240 = V.pt > 240.
dPhiVH = abs( HVdPhi ) > 2.9 
upperHMass = H.mass < 250.
upperHMass_beforeReg = HNoReg.mass < 250.
zMassSafety = V.mass > 50.
trigger = ( Vtype==1 & (triggerFlags[5]>0 || triggerFlags[6]>0) ) || ( Vtype==0 & ( triggerFlags[22]>0 || triggerFlags[23]>0 || triggerFlags[14]>0 ||triggerFlags[21]>0 ) )

;!! ---------------------------------
;!! Windows and windows veto
;!! ---------------------------------
zWindow = V_mass > 75. & V_mass < 105
zWindow2 = V.mass > 82. & V.mass < 100.
zVeto =  (V.mass > 105 | V.mass < 75.)
zVetoSmall =  (V.mass > 100 | V.mass < 80.)
vetoHMass_beforeReg = (HNoReg.mass < 90. | HNoReg.mass > 145.)
vetoHMass = (H.mass < 90. | H.mass > 145.)
MassVeto= (H.mass < 90. | H.mass > 150.)
rMed = V.pt > 50. & V.pt < 100.
rMed2 = V.pt > 100. & V.pt < 150.
rMed_120 = V.pt > 100. & V.pt < 120.
rMed_150 = V.pt > 100. & V.pt < 150.
rMed_240 = V.pt > 100. & V.pt < 150.
rLow2 = V.pt > 50.& V.pt < 100.
looseHMass = H.mass > 40. & H.mass < 250.
looseHMass_beforeReg = HNoReg.mass > 40. & HNoReg.mass < 250.
run_range = (run < 207883 || run > 208307)

;!! -------------------------------------------
;!! Preselections (combination of single cuts)
;!! -------------------------------------------
preselection = Jet_pt[hJCidx[0]] > 20. & Jet_pt[hJCidx[1]] > 20. & abs(Jet_eta[hJCidx[0]]) < 2.4 & abs(Jet_eta[hJCidx[1]]) < 2.4 & Flag_HBHENoiseFilter & Jet_puId[hJCidx[0]] > 0. & Jet_puId[hJCidx[1]] > 0. & <!ZHbb|run_range!>
preselection_beforeReg = (Jet_pt[hJCidx[0]]/hJet_regWeight[0]) > 20. & (Jet_pt[hJCidx[1]]*hJet_regWeight[1]) > 20. & abs(Jet_eta[hJCidx[0]]) < 2.4 & abs(Jet_eta[hJCidx[1]]) < 2.4 & Flag_HBHENoiseFilter & Jet_puId[hJCidx[0]] > 0. & Jet_puId[hJCidx[1]] > 0.& <!ZHbb|run_range!>
looseBTag = !(Jet_btagCSV[hJCidx[0]] > <!ZHbb|CSVL!> & Jet_btagCSV[hJCidx[1]] > <!ZHbb|CSVL!>) & (Jet_btagCSV[hJCidx[0]] > <!ZHbb|CSVL!> | Jet_btagCSV[hJCidx[1]] > <!ZHbb|CSVL!>)
vtx = Jet_vtx3DVal[hJCidx[0]] > 0. & Jet_vtxPt[hJCidx[0]] > 0.
soft = (1[0]==1 || 1[0] == 1) & Jet_leptonDeltaR[hJCidx[0]] > 0.
Mjj_selection = <!ZHbb|preselection!> & <!ZHbb|ccBtag!> & <!ZHbb|zWindow!> & metPuppi_pt < 60. & <!ZHbb|upperHMass!>

;!! ----------------------------------------
;!! Electron muon splitting
;!! ----------------------------------------
[ZHeebb]
addCuts = Vtype==1 
[ZHmmbb]
addCuts = Vtype==0 

;!! ----------------------------------------
;!! Region definitions
;!! ----------------------------------------
[Cuts]

TriggerSingleEle = (Alt$(HLT_BIT_HLT_Ele27_WP85_Gsf_v,0)||Alt$(HLT_BIT_HLT_Ele27_WPLoose_Gsf_v,0))
TriggerSingleMu = (HLT_BIT_HLT_IsoMu20_v)
TriggerMET90 = (Alt$(HLT_BIT_HLT_PFMET90_PFMHT90_IDLoose_v,0)||Alt$(HLT_BIT_HLT_PFMET90_PFMHT90_IDTight_v,0))
TriggerMET = (Alt$(HLT_BIT_HLT_PFMET90_PFMHT90_IDLoose_v,0)||Alt$(HLT_BIT_HLT_PFMET90_PFMHT90_IDTight_v,0))||(HLT_BIT_HLT_PFMET170_NoiseCleaned_v)



;!! Test with heppy ntuple
dy_heppy_test = <!ZHbb|zWindow!>
myTight = Vtype==4 & metPuppi_pt>170 & Jet_btagCSV[hJCidx[0]] > 0.3 & Jet_btagCSV[hJCidx[1]] >0.3 & Jet_pt[hJCidx[0]] > 20. & Jet_pt[hJCidx[1]] > 20. & abs(Jet_eta[hJCidx[0]]) < 2.4 & abs(Jet_eta[hJCidx[1]]) < 2.4 & Flag_HBHENoiseFilter & Jet_puId[hJCidx[0]] > 0. & Jet_puId[hJCidx[1]] > 0. & H.mass > 40. & H.mass < 250.
myVeryTight = Vtype==4 & metPuppi_pt>400 & Jet_btagCSV[hJCidx[0]] > 0.3 & Jet_btagCSV[hJCidx[1]] >0.3 & Jet_pt[hJCidx[0]] > 20. & Jet_pt[hJCidx[1]] > 20. & abs(Jet_eta[hJCidx[0]]) < 2.4 & abs(Jet_eta[hJCidx[1]]) < 2.4 & Flag_HBHENoiseFilter & Jet_puId[hJCidx[0]] > 0. & Jet_puId[hJCidx[1]] > 0. & H.mass > 40. & H.mass < 250.
MyPlot_HighPt_Zvv = <!Cuts|myTight!>


;   Mjj     values[0] = "ZnunuHighPt_VH := HptReg>160 && hJet_pt[0]>80 && max(hJet_csv_nominal[0],hJet_csv_nominal[1])>0.898 && min(hJet_csv_nominal[0],hJet_csv_nominal[1])>0.5 && naJets_Znn==0 && abs(deltaPhi(H.phi,METtype1corr.phi))>2.95 && mindPhiMETJet_dPhi>1.5 && HmassReg>0";


MicheleMjj_HighPt = (Vtype==4) && metPuppi_pt>170 && H.pt>160 && max(hJet_ptNew[0],hJet_ptNew[1])>80 && min(hJet_ptNew[0],hJet_ptNew[1])>20 && max(Jet_btagCSV[hJCidx[0]],Jet_btagCSV[hJCidx[1]])>0.898 && min(Jet_btagCSV[hJCidx[0]],Jet_btagCSV[hJCidx[1]])>0.5 && H.mass<250  && DeltaPhiHCSVMET>2.95 && Flag_HBHENoiseFilter && H.mass>0 && naLeptons==0 && MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>20 && Jet_eta<5.2)>1.5 && (Sum$(Jet_pt>30 && abs(Jet_eta)<5.2))<=2 && metType1p2_pt>170

;MicheleBDT_HighPt = (Vtype==4) && metPuppi_pt>170 && H.pt>170 && max(hJet_ptNew[0],hJet_ptNew[1])>60 && min(hJet_ptNew[0],hJet_ptNew[1])>30 && max(Jet_btagCSV[hJCidx[0]],Jet_btagCSV[hJCidx[1]])>0.85 && min(Jet_btagCSV[hJCidx[0]],Jet_btagCSV[hJCidx[1]])>0.5 && H.mass<250  && DeltaPhiHCSVMET>2.0 && Flag_HBHENoiseFilter && Jet_puId[hJCidx[0]] > 0. & Jet_puId[hJCidx[1]] > 0. && H.mass>0  && metType1p2_pt>200 && mhtJet30>100 && MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Iteration$<1)>1 && MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>100 && Jet_eta<2.5 && Jet_puId)>1 && DeltaPhiJet1Jet2<2.64 && MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>80 && Jet_eta<2.5)>0.5
;;&& MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>20 && Jet_eta<5.2)>0.5

MicheleBDT_HighPt = metType1p2_pt>170 & H.mass<250 && H.mass>50 && DeltaPhiHCSVMET>1.5 && H.pt>140 && minDeltaPhiJet80Met>0.7 && metType1p2_pt/sqrt(met_sumEt)>5 && DeltaPhiJet1Jet2<2.5 && Vtype==4 && hJet_btagCSV[1]>0.7 && hJet_btagCSV[0]>0.85 && Sum$(Jet_pt>30 && abs(Jet_eta)<2.5 && Jet_puId)<=3

Flags = Flag_EcalDeadCellTriggerPrimitiveFilter && Flag_trkPOG_manystripclus53X && Flag_ecalLaserCorrFilter && Flag_trkPOG_toomanystripclus53X && Flag_hcalLaserEventFilter && Flag_trkPOG_logErrorTooManyClusters && Flag_trkPOGFilters  && Flag_HBHENoiseFilter && Flag_goodVertices && Flag_METFilters && Flag_eeBadScFilter  && Flag_CSCTightHaloFilter

;FlagsMET = Flag_hbheFilterNew  &&Flag_eeBadScFilter &&Flag_CSCTightHaloFilter ; &&Flag_hbheIsoFilter && Flag_goodVertices ; FIXME!!!
FlagsMET = Flag_hbheFilterNew  &&Flag_eeBadScFilter 

;<!Cuts|Flags!>


1 = 1
Nothing = 1 && <!Cuts|FlagsMET!> && H.pt>150
QCD = <!Cuts|Nothing!> && MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>20 && abs(Jet_eta)<5.2 && Jet_puId==1)<0.5
NoQCD1 = <!Cuts|Nothing!> && MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>20 && abs(Jet_eta)<5.2)>0.5
;NoQCD1 = <!Cuts|Nothing!> && minDeltaPhiCenJetNoPU40Met >0.5
NoQCD2 = <!Cuts|NoQCD1!> && Jet_chHEF[0]>0.1
NoQCD3 = <!Cuts|NoQCD2!> && (MinIf$(abs(TVector2::Phi_mpi_pi(DiscardedJet_phi-met_phi))-3.1415,DiscardedJet_pt>20 && abs(DiscardedJet_eta)<5.2  && Jet_puId==1)>(0.5-3.1415))

TurnOnEleDen = <!Cuts|NoQCD3!> && <!Cuts|TriggerSingleEle!> && max(Max$(vLeptons_pt),Max$(aLeptons_pt))>27 && max(Max$(vLeptons_pt),Max$(aLeptons_pt))<60
TurnOnEleNum = <!Cuts|TurnOnEleDen!> && <!Cuts|TriggerMET90!>

TurnOnMuDen = <!Cuts|NoQCD3!> && <!Cuts|TriggerSingleMu!> && max(Max$(vLeptons_pt),Max$(aLeptons_pt))>20 && max(Max$(vLeptons_pt),Max$(aLeptons_pt))<60
TurnOnMuNum = <!Cuts|TurnOnMuDen!> && <!Cuts|TriggerMET90!>

TurnOnTTEleDen = <!Cuts|TurnOnEleDen!> && <!ZHbb|addCenJet30!> && Jet_btagCSV[hJCidx[0]]>0.941
TurnOnTTEleNum = <!Cuts|TurnOnTTEleDen!> && <!Cuts|TriggerMET90!>

TurnOnTTMuDen = <!Cuts|TurnOnMuDen!> && <!ZHbb|addCenJet30!> && Jet_btagCSV[hJCidx[0]]>0.941
TurnOnTTMuNum = <!Cuts|TurnOnTTMuDen!> && <!Cuts|TriggerMET90!>

TurnOnQCDEleDen = <!Cuts|QCD!> && <!Cuts|TriggerSingleEle!> && max(Max$(vLeptons_pt),Max$(aLeptons_pt))>27 && max(Max$(vLeptons_pt),Max$(aLeptons_pt))<60
TurnOnQCDEleNum = <!Cuts|TurnOnQCDEleDen!> && <!Cuts|TriggerMET90!>

TurnOnQCDMuDen = <!Cuts|QCD!> && <!Cuts|TriggerSingleMu!> && max(Max$(vLeptons_pt),Max$(aLeptons_pt))>20 && max(Max$(vLeptons_pt),Max$(aLeptons_pt))<60
TurnOnQCDMuNum = <!Cuts|TurnOnQCDMuDen!> && <!Cuts|TriggerMET90!>

TurnOnQCDTTEleDen = <!Cuts|TurnOnQCDEleDen!> && <!ZHbb|addCenJet30!> && Jet_btagCSV[hJCidx[0]]>0.941
TurnOnQCDTTEleNum = <!Cuts|TurnOnQCDTTEleDen!> && <!Cuts|TriggerMET90!>

TurnOnQCDTTMuDen = <!Cuts|TurnOnQCDMuDen!> && <!ZHbb|addCenJet30!> && Jet_btagCSV[hJCidx[0]]>0.941
TurnOnQCDTTMuNum = <!Cuts|TurnOnQCDTTMuDen!> && <!Cuts|TriggerMET90!>

;H.pt>130
;minDeltaPhiJet2Met>0.7
;&& minDeltaPhiJet2Met>0.7 && minDeltaPhiCenJetNoPU30Met >0.5
;tkMetPVchs_pt>25 && tkMet_pt>25
;metType1p2_pt/sqrt(met_sumEt)>5 && DeltaPhiJet1Jet2<2.5

CR_Nothing = <!Cuts|NoQCD3!>
CR_TTbar = <!Cuts|NoQCD3!> && VetoLeptons>=1 && (addCenJet30)>=1 && Jet_btagCSV[hJCidx[0]]> <!ZHbb|CSV_Medium!>
CR_WLight = <!Cuts|NoQCD3!> && VetoLeptons==1 && (addCenJet30)==0 && Jet_btagCSV[hJCidx[0]]< <!ZHbb|CSV_Medium!>
;CR_Wbb = <!Cuts|NoQCD3!> && VetoLeptons==1 && (addCenJet30)==0 && Jet_btagCSV[hJCidx[0]]> <!ZHbb|CSV_Medium!> && H.pt>170 && MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>20  && Jet_eta<5.2 )>2
CR_Wbb = <!Cuts|NoQCD3!> && VetoLeptons==1 && (addCenJet30)==0 && Jet_btagCSV[hJCidx[0]]> <!ZHbb|CSV_Medium!> 
CR_ZLight = <!Cuts|NoQCD3!> && VetoLeptons==0  && (addCenJet30)==0 && Jet_btagCSV[hJCidx[0]]< <!ZHbb|CSV_Medium!>
CR_Zbb = <!Cuts|NoQCD3!> && VetoLeptons==0 && (addCenJet30)==0 && Jet_btagCSV[hJCidx[0]]> <!ZHbb|CSV_Medium!>  && (H.mass<110 || H.mass>140)
CR_QCD = <!Cuts|Nothing!> && MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>25  && Jet_eta<5.2  && Jet_puId==1)<0.5
CR_W = <!Cuts|NoQCD3!> && VetoLeptons==1 && (addCenJet30)==0 && H.pt>170 && MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>20  && Jet_eta<5.2  && Jet_puId==1)>2
CR_Z = <!Cuts|NoQCD3!> && VetoLeptons==0 && (addCenJet30)==0 && (H.mass<110 || H.mass>140)

AllBDT = <!Cuts|NoQCD3!> && Vtype==4&& VetoLeptons<=1 
All = <!Cuts|AllBDT!>  && Jet_btagCSV[hJCidx[1]]>0.85 && Jet_btagCSV[hJCidx[0]]>0.941 && addCenJet30==0 && naddGoodLeptons5==0
CutAndCount = <!Cuts|All!> && H.mass<140 && H.mass>105 && met_pt>160 && HCSV_reg_pt>160 && Jet_btagCSV[hJCidx[1]]>0.2 && abs(TVector2::Phi_mpi_pi(HCSV_reg_phi-met_phi))>1.5 && min(Jet_pt[hJCidx[0]],Jet_pt[hJCidx[1]])>30 && HCSV_reg_mass<300 && HCSV_mass>0 && minDeltaPhiJet2Met>0.7 && minDeltaPhiCenJetNoPU30Met >0.5 && tkMetPVchs_pt>25 && tkMet_pt>25
AllBDTWithWeights= ( <!Cuts|AllBDT!> )
AllBDTOnlyPositiveWeights= ( <!Cuts|AllBDT!> && sign(genWeight)>0 )

BDTNoMjj_CR = <!Cuts|AllBDT!> && ZvvBDTNoMjj.nominal>-0.2 && ZvvBDTNoMjj.nominal<0.2
BDTNoMjj_LowPurity = <!Cuts|AllBDT!> && ZvvBDTNoMjj.nominal>0.2 && ZvvBDTNoMjj.nominal<0.6
BDTNoMjj_HighPurity = <!Cuts|AllBDT!> && ZvvBDTNoMjj.nominal>0.6 && ZvvBDTNoMjj.nominal<1

NoQCDBeforeSys = <!Cuts|Nothing!> && HCSV_pt>150 && MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Iteration$<2)>0.7 &&  MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>30 && Jet_eta<5.2 && Jet_puId==1)>0.5 && (Sum$(Jet_pt>30 && abs(Jet_eta)<5.2)-2)<=1 && abs(TVector2::Phi_mpi_pi(tkMetPVchs_phi-met_phi))<0.4 && 1==1
CR_WLightBeforeSys = <!Cuts|NoQCDBeforeSys!>  && (Jet_btagCSV[hJCidx[0]]< <!ZHbb|CSV_Medium!>) && (<!ZHbb|VetoLeptons!>) >=1
CR_WbbBeforeSys = <!Cuts|NoQCDBeforeSys!>   && (Jet_btagCSV[hJCidx[0]]> <!ZHbb|CSV_Medium!>) && (<!ZHbb|VetoLeptons!>) ==1 && <!ZHbb|addCenJet30!>==0 && HCSV_pt>200
CR_ZLightBeforeSys = <!Cuts|NoQCDBeforeSys!>  && (Jet_btagCSV[hJCidx[0]]< <!ZHbb|CSV_Medium!>) && (<!ZHbb|VetoLeptons!>) ==0
CR_ZbbBeforeSys = <!Cuts|NoQCDBeforeSys!>  && (Jet_btagCSV[hJCidx[0]]> <!ZHbb|CSV_Medium!>) && (H_mass<110 || H_mass>140) && (<!ZHbb|VetoLeptons!>) ==0

CR_QCDBeforeSys = <!Cuts|Nothing!> && HCSV_pt>100 && MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Iteration$<2)<0.5
CR_TTbarBeforeSys = <!Cuts|NoQCDBeforeSys!> && (Jet_btagCSV[hJCidx[0]]> <!ZHbb|CSV_Medium!>) && (<!ZHbb|VetoLeptons!>) >=1 && (<!ZHbb|addCenJet30!>) >=1
CR_WBeforeSys = <!Cuts|NoQCDBeforeSys!> && (<!ZHbb|VetoLeptons!>) ==1 && <!ZHbb|addCenJet30!>==0
CR_ZBeforeSys = <!Cuts|NoQCDBeforeSys!> && (H_mass<110 || H_mass>140) && (<!ZHbb|VetoLeptons!>) ==0 && <!ZHbb|addCenJet30!>==0

NoQCDBeforeSys_reg = <!Cuts|NoQCDBeforeSys!>
CR_TTbarBeforeSys_reg = <!Cuts|CR_TTbarBeforeSys!>

nPVs = <!Cuts|NoQCDBeforeSys!> && met_pt>160 && (Jet_btagCSV[hJCidx[0]]< <!ZHbb|CSV_Medium!> ) && (<!ZHbb|naddGoodLeptons5!>) >=1


AllBDTLog = <!Cuts|AllBDT!>

Muons = <!Cuts|NoQCD3!> && Vtype==4 && naLeptons==1 && aLeptons_pt[0]>40 && abs(aLeptons_pdgId[0])==13
Electrons = <!Cuts|NoQCD3!> && Vtype==4 && naLeptons==1 && aLeptons_pt[0]>40 && abs(aLeptons_pdgId[0])==11

quick = 1
;  BDT      values[0] = "ZnunuHighPt_VH := (Vtype==4) && METtype1corr.et>170 && HptReg>130 && max(hJet_pt[0],hJet_pt[1])>60 && min(hJet_pt[0],hJet_pt[1])>30 && max(hJet_csv_nominal[0],hJet_csv_nominal[1])>0.679 && min(hJet_csv_nominal[0],hJet_csv_nominal[1])>0.244 && HmassReg<250 && mindPhiMETJet_dPhi>0.5 && abs(deltaPhi(METtype1corr.phi,METnoPUCh.phi))<0.5 && abs(deltaPhi(H.phi,METtype1corr.phi))>2.0 && nalep_pt5_Znn==0 && hbhe && ecalFlag && cschaloFlag && hcallaserFlag && trackingfailureFlag && eebadscFlag && !isBadHcalEvent && hJet_puJetIdL[0]>0 && hJet_puJetIdL[1]>0 && HmassReg>0";

;!! -------------
;!! Mjj
;!! -------------
mjjLowPt = <!ZHbb|preselection!> & <!ZHbb|rMed!> & <!ZHbb|tlBtag!> & <!ZHbb|zWindow!> & <!ZHbb|max1AddJet!> & <!ZHbb|upperHMass!> & <!ZHbb|dPhiVH!>
mjjHighPt = <!ZHbb|preselection!> & <!ZHbb|rTight!> & <!ZHbb|tlBtag!> & <!ZHbb|zWindow!> & <!ZHbb|max1AddJet!> & <!ZHbb|upperHMass!> & <!ZHbb|dPhiVH!>
mjjHighPt_opt = <!ZHbb|preselection!> & <!ZHbb|rTight2!> & <!ZHbb|ccBtag!> & <!ZHbb|zWindow2!> & <!ZHbb|upperHMass!> & <!ZHbb|dPhiVH!>
mjjLowPt_opt = <!ZHbb|preselection!> & <!ZHbb|rLow2!> & <!ZHbb|tcBtag!> & <!ZHbb|zWindow2!> & <!ZHbb|max1AddJet!> & <!ZHbb|upperHMass!> & <!ZHbb|dPhiVH!>
mjjMedPt_opt = <!ZHbb|preselection!> & <!ZHbb|rMed2!> & <!ZHbb|ccBtag!> & <!ZHbb|zWindow2!> & <!ZHbb|upperHMass!> & <!ZHbb|dPhiVH!>

;!! ----------------
;!! V.pt regions
;!! ----------------
RMed = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVC!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rMed!> & <!ZHbb|looseHMass!>
RTight = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight!> & <!ZHbb|upperHMass!>
RTightLooseBTag = <!ZHbb|30jets!> & <!ZHbb|preselection!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight!> & <!ZHbb|upperHMass!> & <!ZHbb|looseBTag!>
RLoose = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVC!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rLoose!>
RMed_120 = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVC!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rMed_120!>
RTight_120 = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight_120!>
RMed_150 = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVC!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rMed_150!> 
RTight_150 = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight_150!>
RMed_240 = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVC!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rMed_240!> 
RTight_240 = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight_240!>

HighPt = <!Cuts|RTight!>
LowPt = <!Cuts|RMed!>
HighPtLooseBTag = <!Cuts|RTightLooseBTag!>

;!! ---------------------
;!! individual training
;!! ---------------------
RTight_andTT = <!Cuts|RTight!> & TT_HighPt_ZH125_nov.nominal > 0.28
myTight_andTT = <!Cuts|myTight!> & myBDT-TT.nominal > 0.28
RTight_andDY = <!Cuts|RTight!> & TT_HighPt_ZH125_nov.nominal > 0.28 & DY_HighPt_ZH125_nov.nominal > -0.1
HighPt_ExpertRegion0 = <!Cuts|RTight!> & TT_HighPt_ZH125_nov.nominal <= 0.28
HighPt_ExpertRegion1 = <!Cuts|RTight!> & TT_HighPt_ZH125_nov.nominal > 0.28 & DY_HighPt_ZH125_nov.nominal <= -0.1
HighPt_ExpertRegion2 = <!Cuts|RTight!> & TT_HighPt_ZH125_nov.nominal > 0.28 & DY_HighPt_ZH125_nov.nominal > -0.1 & VV_HighPt_ZH125_nov.nominal <= 0.28
HighPt_ExpertRegion3 = <!Cuts|RTight!> & TT_HighPt_ZH125_nov.nominal > 0.28 & DY_HighPt_ZH125_nov.nominal > -0.1 & VV_HighPt_ZH125_nov.nominal > 0.28
;!! Electron muon splitting
HighPt_ExpertRegion0_EE = <!Cuts|RTight!> & TT_HighPt_ZH125_nov.nominal <= 0.28 & <!ZHeebb|addCuts!>
HighPt_ExpertRegion1_EE = <!Cuts|RTight!> & TT_HighPt_ZH125_nov.nominal > 0.28 & DY_HighPt_ZH125_nov.nominal <= -0.1 & <!ZHeebb|addCuts!>
HighPt_ExpertRegion2_EE = <!Cuts|RTight!> & TT_HighPt_ZH125_nov.nominal > 0.28 & DY_HighPt_ZH125_nov.nominal > -0.1 & VV_HighPt_ZH125_nov.nominal <= 0.28 & <!ZHeebb|addCuts!>
HighPt_ExpertRegion3_EE = <!Cuts|RTight!> & TT_HighPt_ZH125_nov.nominal > 0.28 & DY_HighPt_ZH125_nov.nominal > -0.1 & VV_HighPt_ZH125_nov.nominal > 0.28 & <!ZHeebb|addCuts!>
HighPt_ExpertRegion0_MM = <!Cuts|RTight!> & TT_HighPt_ZH125_nov.nominal <= 0.28 & <!ZHmmbb|addCuts!>
HighPt_ExpertRegion1_MM = <!Cuts|RTight!> & TT_HighPt_ZH125_nov.nominal > 0.28 & DY_HighPt_ZH125_nov.nominal <= -0.1 & <!ZHmmbb|addCuts!>
HighPt_ExpertRegion2_MM = <!Cuts|RTight!> & TT_HighPt_ZH125_nov.nominal > 0.28 & DY_HighPt_ZH125_nov.nominal > -0.1 & VV_HighPt_ZH125_nov.nominal <= 0.28 & <!ZHmmbb|addCuts!>
HighPt_ExpertRegion3_MM = <!Cuts|RTight!> & TT_HighPt_ZH125_nov.nominal > 0.28 & DY_HighPt_ZH125_nov.nominal > -0.1 & VV_HighPt_ZH125_nov.nominal > 0.28 & <!ZHmmbb|addCuts!>

;!! ------------------------------
;!! Regions for scale factors fit
;!! ------------------------------
RTight_TTbar_fit = <!ZHbb|zMassSafety!> & <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zVeto!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight!>
RMed_TTbar_fit = <!ZHbb|zMassSafety!> & <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVC!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zVeto!> & <!ZHbb|pullAngle!> & <!ZHbb|rMed!>
RTight_TTbarOpen_fit = <!ZHbb|zMassSafety!> & <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zVetoSmall!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight!>
RMed_TTbarOpen_fit = <!ZHbb|zMassSafety!> & <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVC!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zVetoSmall!> & <!ZHbb|pullAngle!> & <!ZHbb|rMed!>

RTight_DYJets_fit = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight!> & <!ZHbb|vetoHMass!>
;!! For RMed_DYJets_fit region: btag extrapolation from loose (in the fit region) to custom (in the signal region)
RMed_DYJets_fit = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rMed!> & <!ZHbb|vetoHMass!> 
;!! Sum high / low pt
DYJets_fit = <!Cuts|RTight_DYJets_fit!> || <!Cuts|RMed_DYJets_fit!>
TTbar_fit = <!Cuts|RTight_TTbar_fit!> || <!Cuts|RMed_TTbar_fit!>
ZLight_fit = <!Cuts|ZLight_HighPt!> || <!Cuts|ZLight_LowPt!>

;!! Electron - Muons splitting
DYJets_fit_EE = (<!Cuts|RTight_DYJets_fit!> || <!Cuts|RMed_DYJets_fit!>) & <!ZHeebb|addCuts!>
TTbar_fit_EE = (<!Cuts|RTight_TTbar_fit!> || <!Cuts|RMed_TTbar_fit!>) & <!ZHeebb|addCuts!>
DYJets_fit_MM = (<!Cuts|RTight_DYJets_fit!> || <!Cuts|RMed_DYJets_fit!>) & <!ZHmmbb|addCuts!>
TTbar_fit_MM = (<!Cuts|RTight_TTbar_fit!> || <!Cuts|RMed_TTbar_fit!>) & <!ZHmmbb|addCuts!>

RTight_TTbar_fit_EE = <!Cuts|RTight_TTbar_fit!> & <!ZHeebb|addCuts!>
RTight_TTbar_fit_MM = <!Cuts|RTight_TTbar_fit!> & <!ZHmmbb|addCuts!>
RMed_TTbar_fit_EE = <!Cuts|RMed_TTbar_fit!> & <!ZHeebb|addCuts!>
RMed_TTbar_fit_MM = <!Cuts|RMed_TTbar_fit!> & <!ZHmmbb|addCuts!>
RTight_DYJets_fit_EE = <!Cuts|RTight_DYJets_fit!> & <!ZHeebb|addCuts!>
RTight_DYJets_fit_MM = <!Cuts|RTight_DYJets_fit!> & <!ZHmmbb|addCuts!>
RMed_DYJets_fit_EE = <!Cuts|RMed_DYJets_fit!> & <!ZHeebb|addCuts!>
RMed_DYJets_fit_MM = <!Cuts|RMed_DYJets_fit!> & <!ZHmmbb|addCuts!>
RTight_TTbarOpen_fit_EE = <!Cuts|RTight_TTbarOpen_fit!> & <!ZHeebb|addCuts!>
RTight_TTbarOpen_fit_MM = <!Cuts|RTight_TTbarOpen_fit!> & <!ZHmmbb|addCuts!>
RMed_TTbarOpen_fit_EE = <!Cuts|RMed_TTbarOpen_fit!> & <!ZHeebb|addCuts!>
RMed_TTbarOpen_fit_MM = <!Cuts|RMed_TTbarOpen_fit!> & <!ZHmmbb|addCuts!>

;!! -------------------------
;!! Control regions
;!! -------------------------
;!!Standard control regions
TTbar_unbiased = <!ZHbb|zMassSafety!> & <!ZHbb|preselection!> & metPuppi_pt > 60. & <!ZHbb|zVeto!> & <!ZHbb|pullAngle!> & <!ZHbb|upperHMass!>
ZLight= <!ZHbb|preselection!> & <!ZHbb|noAddJet!> & <!ZHbb|zWindow!> & <!ZHbb|ntBtag!> & <!ZHbb|upperHMass!> & <!ZHbb|twoCSV0!> & <!ZHbb|dPhiVH!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & V.pt > 50.
TTbar = <!ZHbb|preselection!> & <!ZHbb|upperHMass!> & <!ZHbb|tcBtag!> & <!ZHbb|zVeto!> & H.pt > 100.
Zbb = <!ZHbb|preselection!> & <!ZHbb|vetoHMass!> & <!ZHbb|upperHMass!> & <!ZHbb|zWindow!> & <!ZHbb|tcBtag!> & <!ZHbb|max1AddJet!> & <!ZHbb|dPhiVH!> 
ZLight_beforeReg = <!ZHbb|preselection_beforeReg!> & <!ZHbb|noAddJet!> & <!ZHbb|zWindow!> & <!ZHbb|ntBtag!> & <!ZHbb|upperHMass_beforeReg!> & <!ZHbb|twoCSV0!> & <!ZHbb|dPhiVH!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!>
TTbar_beforeReg = <!ZHbb|preselection_beforeReg!> & <!ZHbb|upperHMass_beforeReg!> & <!ZHbb|tcBtag!> & <!ZHbb|zVeto!> & HNoReg.pt > 100.
Zbb_beforeReg = <!ZHbb|preselection_beforeReg!> & <!ZHbb|vetoHMass_beforeReg!> & <!ZHbb|upperHMass_beforeReg!> & <!ZHbb|zWindow!> & <!ZHbb|tcBtag!> & <!ZHbb|max1AddJet!> & <!ZHbb|dPhiVH!> 
Zbb_Balance = <!ZHbb|preselection!> & <!ZHbb|zWindow!> & <!ZHbb|ccBtag!> & <!ZHbb|noAddJet!> & V.pt > 50. & H.pt/V.pt < 2.
Zbb_BalanceNoReg = <!ZHbb|preselection_beforeReg!> & <!ZHbb|zWindow!> & <!ZHbb|ccBtag!> & <!ZHbb|noAddJet!> & V.pt > 50. & HNoReg.pt/V.pt < 2. 
;MyRegion_HighPt_Zvv = metPuppi_pt>300 & H.mass<250 & H.mass>50 & Jet_btagCSV[hJCidx[0]]>0.5 & Jet_btagCSV[hJCidx[1]]>0.5
MyRegion_HighPt_Zvv = <!Cuts|myTight!>
ZLight_HighPt = <!Cuts|ZLight!> & <!ZHbb|rTight!>
ZLight_HighPt_beforeReg = <!Cuts|ZLight_beforeReg!> & <!ZHbb|rTight!>
TTbar_HighPt = <!Cuts|TTbar!> & <!ZHbb|rTight!>
Zbb_HighPt = <!Cuts|Zbb!> & <!ZHbb|rTight!>
ZPeak = <!ZHbb|preselection!> & <!ZHbb|zWindow!> & <!ZHbb|upperHMass!> & <!ZHbb|twoCSV0!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> 
ZPeak_Zee = <!ZHbb|zWindow!> & <!ZHeebb|addCuts!> & Jet_pt[hJCidx[0]] > 20. & Jet_pt[hJCidx[1]] > 20.
ZPeak_Zmm = <!ZHbb|zWindow!> & <!ZHmmbb|addCuts!> & Jet_pt[hJCidx[0]] > 20. & Jet_pt[hJCidx[1]] > 20.
ZLight_LowPt = <!Cuts|ZLight!> & <!ZHbb|rMed!> & H.mass > 50.
ZLight_LowPt_beforeReg = <!Cuts|ZLight_beforeReg!> & <!ZHbb|rMed!> & HNoReg.mass > 50.
TTbar_LowPt = <!Cuts|TTbar!> & <!ZHbb|rMed!>
Zbb_LowPt = <!Cuts|Zbb!> & <!ZHbb|rMed!>
ZLight_HighPt_Zee = <!Cuts|ZLight_HighPt!> & <!ZHeebb|addCuts!>
ZLight_HighPt_Zmm = <!Cuts|ZLight_HighPt!> & <!ZHmmbb|addCuts!>
ZLight_LowPt_Zee = <!Cuts|ZLight_LowPt!> & <!ZHeebb|addCuts!>
ZLight_LowPt_Zmm = <!Cuts|ZLight_LowPt!> & <!ZHmmbb|addCuts!>
TTbar_Zee = <!Cuts|TTbar!> & <!ZHeebb|addCuts!>
TTbar_Zmm = <!Cuts|TTbar!> & <!ZHmmbb|addCuts!>
Zbb_Zee = <!Cuts|Zbb!> & <!ZHeebb|addCuts!>
Zbb_Zmm = <!Cuts|Zbb!> & <!ZHmmbb|addCuts!>
Zbb_HighPt_Zee = <!Cuts|Zbb!> & <!ZHbb|rTight!> & <!ZHeebb|addCuts!>
Zbb_HighPt_Zmm = <!Cuts|Zbb!> & <!ZHbb|rTight!> & <!ZHmmbb|addCuts!>
Zbb_LowPt_Zee = <!Cuts|Zbb!> & <!ZHbb|rMed!> & <!ZHeebb|addCuts!>
Zbb_LowPt_Zmm = <!Cuts|Zbb!> & <!ZHbb|rMed!> & <!ZHmmbb|addCuts!>
TTbar_vtx = <!Cuts|TTbar!> & <!ZHbb|vtx!>
TTbar_soft = <!Cuts|TTbar!> & <!ZHbb|soft!>
Zbb_vtx = <!Cuts|Zbb!> & <!ZHbb|vtx!>
Zbb_soft = <!Cuts|Zbb!> & <!ZHbb|soft!>
;!! IVF regions: Additional cut on the number of inclusive secondary vertices
RTight_TTbar_fit_SV = <!ZHbb|zMassSafety!> & <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zVeto!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight!> & nSvs==2
RMed_TTbar_fit_SV = <!ZHbb|zMassSafety!> & <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVC!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zVeto!> & <!ZHbb|pullAngle!> & <!ZHbb|rMed!> & nSvs==2
RTight_DYJets_fit_SV = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight!> & <!ZHbb|vetoHMass!> & nSvs==2
RMed_DYJets_fit_SV = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rMed!> & <!ZHbb|vetoHMass!> & nSvs==2

RTight_DYJets_fit_SV_gs = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight!> & <!ZHbb|vetoHMass!> & nSvs==2 & SVH.dPhi < 1.0
RMed_DYJets_fit_SV_gs = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rMed!> & <!ZHbb|vetoHMass!> & nSvs==2 & SVH.dPhi < 1.0

RTight_DYJets_fit_SV_dR1 = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight!> & <!ZHbb|vetoHMass!> & nSvs==2 & SVH.dPhi > 1.0
RMed_DYJets_fit_SV_dR1 = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rMed!> & <!ZHbb|vetoHMass!> & nSvs==2 & SVH.dPhi > 1.0
RTight_DYJets_fit_SV_dR5 = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight!> & <!ZHbb|vetoHMass!> & nSvs==2 & SVH.dPhi > 0.5
RMed_DYJets_fit_SV_dR5 = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rMed!> & <!ZHbb|vetoHMass!> & nSvs==2 & SVH.dPhi > 0.5

RTight_Z1b_SV = <!ZHbb|preselection!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight!> & <!ZHbb|vetoHMass!> & nSvs==2
RTight_Z1b_SV_gs = <!ZHbb|preselection!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight!> & <!ZHbb|vetoHMass!> & nSvs==2 & SVH.dPhi < 1.0
RTight_Z1b_SV_dR1 = <!ZHbb|preselection!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight!> & <!ZHbb|vetoHMass!> & nSvs==2 & SVH.dPhi > 1.0
RTight_Z1b_SV_dR5 = <!ZHbb|preselection!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight!> & <!ZHbb|vetoHMass!> & nSvs==2 & SVH.dPhi > 0.5
;!! Inclusive in Vpt
TTbar_fit_SV = <!ZHbb|zMassSafety!> & <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zVeto!> & <!ZHbb|pullAngle!> & nSvs==2
DYJets_fit_SV = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|vetoHMass!> & nSvs==2


;!! ---------------------------
;!! Electron muons separation
;!! ---------------------------
RTight_EE = Vtype==1  & <!Cuts|RTight!>
RTight_MM = Vtype==0 & <!Cuts|RTight!>
RTight_120_EE = Vtype==1  & <!Cuts|RTight_120!>
RTight_120_MM = Vtype==0 & <!Cuts|RTight_120!>
RTight_150_EE = Vtype==1  & <!Cuts|RTight_150!>
RTight_150_MM = Vtype==0 & <!Cuts|RTight_150!>
RTight_240_EE = Vtype==1  & <!Cuts|RTight_240!>
RTight_240_MM = Vtype==0 & <!Cuts|RTight_240!>
RMed_EE = Vtype==1 & <!Cuts|RMed!>
RMed_MM = Vtype==0 & <!Cuts|RMed!>
RMed_120_EE = Vtype==1  & <!Cuts|RMed_120!>
RMed_120_MM = Vtype==0 & <!Cuts|RMed_120!>
RMed_150_EE = Vtype==1  & <!Cuts|RMed_150!>
RMed_150_MM = Vtype==0 & <!Cuts|RMed_150!>
RMed_240_EE = Vtype==1  & <!Cuts|RMed_240!>
RMed_240_MM = Vtype==0 & <!Cuts|RMed_240!>
RLoose_EE = Vtype==1  & <!Cuts|RLoose!>
RLoose_MM = Vtype==0  & <!Cuts|RLoose!>
RTightLooseBTag_EE = Vtype==1 & <!Cuts|RTightLooseBTag!>
RTightLooseBTag_MM = Vtype==0 & <!Cuts|RTightLooseBTag!>
;!! Change naming
HighPt_EE = Vtype==1  & <!Cuts|RTight!>
HighPt_MM = Vtype==0 & <!Cuts|RTight!>
HighPt_Zee = <!Cuts|RTight_EE!>
HighPt_Zmm = <!Cuts|RTight_MM!>
LowPt_EE = Vtype==1 & <!Cuts|RMed!>
LowPt_MM = Vtype==0 & <!Cuts|RMed!>
LowPt_Zee = <!Cuts|RMed_EE!>
LowPt_Zmm = <!Cuts|RMed_MM!>
HighPtLooseBTag_EE = Vtype==1 & <!Cuts|RTightLooseBTag!>
HighPtLooseBTag_MM = Vtype==0 & <!Cuts|RTightLooseBTag!>
HighPtLooseBTag_Zee = <!Cuts|RTightLooseBTag_EE!>
HighPtLooseBTag_Zmm = <!Cuts|RTightLooseBTag_MM!>
TTbar_unbiased_Zee = <!Cuts|TTbar_unbiased!> & <!ZHeebb|addCuts!>
TTbar_unbiased_Zmm = <!Cuts|TTbar_unbiased!> & <!ZHmmbb|addCuts!>
Zbb_soft_Zee = <!Cuts|Zbb!> & <!ZHbb|soft!> & <!ZHeebb|addCuts!>
Zbb_soft_Zmm = <!Cuts|Zbb!> & <!ZHbb|soft!> & <!ZHmmbb|addCuts!>
;!! Very loose pt region ( 0-50 )
VLowPt_Zee = <!Cuts|RLoose_EE!>
VLowPt_Zmm = <!Cuts|RLoose_MM!>
;!! IVF regions
RTight_TTbar_fit_SV_EE = <!Cuts|RTight_TTbar_fit_SV!> & <!ZHeebb|addCuts!>
RTight_TTbar_fit_SV_MM = <!Cuts|RTight_TTbar_fit_SV!> & <!ZHmmbb|addCuts!>
RMed_TTbar_fit_SV_EE = <!Cuts|RMed_TTbar_fit_SV!> & <!ZHeebb|addCuts!>
RMed_TTbar_fit_SV_MM = <!Cuts|RMed_TTbar_fit_SV!> & <!ZHmmbb|addCuts!>
RTight_DYJets_fit_SV_EE = <!Cuts|RTight_DYJets_fit_SV!> & <!ZHeebb|addCuts!>
RTight_DYJets_fit_SV_MM = <!Cuts|RTight_DYJets_fit_SV!> & <!ZHmmbb|addCuts!>
RMed_DYJets_fit_SV_EE = <!Cuts|RMed_DYJets_fit_SV!> & <!ZHeebb|addCuts!>
RMed_DYJets_fit_SV_MM = <!Cuts|RMed_DYJets_fit_SV!> & <!ZHmmbb|addCuts!>
TTbar_fit_SV_EE = <!Cuts|TTbar_fit_SV!> & <!ZHeebb|addCuts!>
TTbar_fit_SV_MM = <!Cuts|TTbar_fit_SV!> & <!ZHmmbb|addCuts!>
DYJets_fit_SV_EE = <!Cuts|DYJets_fit_SV!> & <!ZHeebb|addCuts!>
DYJets_fit_SV_MM = <!Cuts|DYJets_fit_SV!> & <!ZHmmbb|addCuts!>
RTight_Z1b_SV_EE = <!Cuts|RTight_Z1b_SV!> & <!ZHeebb|addCuts!>
RTight_Z1b_SV_MM = <!Cuts|RTight_Z1b_SV!> & <!ZHmmbb|addCuts!>


;!! --------------------------
;!! VV regions
;!! --------------------------
ZZll = <!ZHbb|zWindow!> & Jet_pt[hJCidx[0]] > 40. & Jet_pt[hJCidx[1]] > 20. & <!ZHbb|preselection!> & <!ZHbb|tcBtag!> & metPuppi_pt < 45.
ZZll_Zee = <!ZHeebb|addCuts!> & <!ZHbb|zWindow!> & Jet_pt[hJCidx[0]] > 40. & Jet_pt[hJCidx[1]] > 20. & <!ZHbb|preselection!> & <!ZHbb|tcBtag!> & metPuppi_pt < 45.
ZZll_Zmm = <!ZHmmbb|addCuts!> & <!ZHbb|zWindow!> & Jet_pt[hJCidx[0]] > 40. & Jet_pt[hJCidx[1]] > 20. & <!ZHbb|preselection!> & <!ZHbb|tcBtag!> & metPuppi_pt < 45.

;!! ---------------------
;!! Mjj
;!! ---------------------
;LowPt_MJJ_Zee = <!ZHeebb|addCuts!> & <!Cuts|mjjLowPt!> 
;LowPt_MJJ_Zmm = <!ZHmmbb|addCuts!> & <!Cuts|mjjLowPt!> 
LowPt_MJJ_Zee = <!ZHeebb|addCuts!> & <!Cuts|mjjLowPt_opt!> 
LowPt_MJJ_Zmm = <!ZHmmbb|addCuts!> & <!Cuts|mjjLowPt_opt!> 
;HighPt_MJJ_Zee = <!ZHeebb|addCuts!> & <!Cuts|mjjHighPt!>
;HighPt_MJJ_Zmm = <!ZHmmbb|addCuts!> & <!Cuts|mjjHighPt!> 
HighPt_MJJ_Zee = <!ZHeebb|addCuts!> & <!Cuts|mjjHighPt_opt!>
HighPt_MJJ_Zmm = <!ZHmmbb|addCuts!> & <!Cuts|mjjHighPt_opt!> 
MedPt_MJJ_Zee = <!ZHeebb|addCuts!> & <!Cuts|mjjMedPt_opt!>
MedPt_MJJ_Zmm = <!ZHmmbb|addCuts!> & <!Cuts|mjjMedPt_opt!> 

;!! --------------------------------
;!! Fat higgs control regions
;!! --------------------------------
Zbb_fatH = <!ZHbb|preselection!> & <!ZHbb|vetoHMass!> & <!ZHbb|upperHMass!> & <!ZHbb|zWindow!> & <!ZHbb|ccBtag!> & <!ZHbb|max1AddJet!> & <!ZHbb|dPhiVH!> & V.pt > 100 & fathFilterJets_pt > 20
Zbb_Zee_fatH = <!Cuts|Zbb_fatH!> & <!ZHeebb|addCuts!> 
Zbb_Zmm_fatH = <!Cuts|Zbb_fatH!> & <!ZHmmbb|addCuts!>

;!! --------------
;!! ATLAS Mjj 
;!! --------------
ATLAS_preselection = Jet_pt[hJCidx[0]] > 45. & Jet_pt[hJCidx[1]] > 20. & abs(Jet_eta[hJCidx[0]]) < 2.4 & abs(Jet_eta[hJCidx[1]]) < 2.4 & Flag_HBHENoiseFilter & Jet_puId[hJCidx[0]] > 0. & Jet_puId[hJCidx[1]] > 0.
ATLAS_zWindow = V.mass > 83. & V.mass < 99
ATLAS_Mjj = <!Cuts|ATLAS_preselection!> & <!ZHbb|ccBtag!> & metPuppi_pt < 60. & <!Cuts|ATLAS_zWindow!>
;ATLAS_Mjj = <!Cuts|ATLAS_preselection!> & <!ZHbb|ccBtag!> & metPuppi_pt < 60. & <!Cuts|ATLAS_zWindow!> & <!ZHbb|dPhiVH!>

ATLAS_Mjj_pt50 =     <!Cuts|ATLAS_Mjj!>               & V.pt <= 50.
ATLAS_Mjj_pt50100 =  <!Cuts|ATLAS_Mjj!> & V.pt > 50.  & V.pt <= 100.
ATLAS_Mjj_pt100150 = <!Cuts|ATLAS_Mjj!> & V.pt > 100. & V.pt <= 150.
ATLAS_Mjj_pt150200 = <!Cuts|ATLAS_Mjj!> & V.pt > 150. & V.pt <= 200.
ATLAS_Mjj_pt200 =    <!Cuts|ATLAS_Mjj!> & V.pt > 200.

ATLAS_Mjj_pt50_dR =     <!Cuts|ATLAS_Mjj_pt50!>     & H.dR > 0.7
ATLAS_Mjj_pt50100_dR =  <!Cuts|ATLAS_Mjj_pt50100!>  & H.dR > 0.7
ATLAS_Mjj_pt100150_dR = <!Cuts|ATLAS_Mjj_pt100150!> & H.dR > 0.7
ATLAS_Mjj_pt150200_dR = <!Cuts|ATLAS_Mjj_pt150200!> & H.dR > 0.7 & H.dR < 1.8
ATLAS_Mjj_pt200_dR =    <!Cuts|ATLAS_Mjj_pt200!>                 & H.dR < 1.6

ATLAS_Mjj_pt50_dR_Zee =     <!Cuts|ATLAS_Mjj_pt50!>     & H.dR > 0.7              & <!ZHeebb|addCuts!>
ATLAS_Mjj_pt50100_dR_Zee =  <!Cuts|ATLAS_Mjj_pt50100!>  & H.dR > 0.7              & <!ZHeebb|addCuts!> 
ATLAS_Mjj_pt100150_dR_Zee = <!Cuts|ATLAS_Mjj_pt100150!> & H.dR > 0.7              & <!ZHeebb|addCuts!>
ATLAS_Mjj_pt150200_dR_Zee = <!Cuts|ATLAS_Mjj_pt150200!> & H.dR > 0.7 & H.dR < 1.8 & <!ZHeebb|addCuts!>
ATLAS_Mjj_pt200_dR_Zee =    <!Cuts|ATLAS_Mjj_pt200!>                 & H.dR < 1.6 & <!ZHeebb|addCuts!>

ATLAS_Mjj_pt50_dR_Zmm =     <!Cuts|ATLAS_Mjj_pt50!>     & H.dR > 0.7              & <!ZHmmbb|addCuts!>
ATLAS_Mjj_pt50100_dR_Zmm =  <!Cuts|ATLAS_Mjj_pt50100!>  & H.dR > 0.7              & <!ZHmmbb|addCuts!> 
ATLAS_Mjj_pt100150_dR_Zmm = <!Cuts|ATLAS_Mjj_pt100150!> & H.dR > 0.7              & <!ZHmmbb|addCuts!>
ATLAS_Mjj_pt150200_dR_Zmm = <!Cuts|ATLAS_Mjj_pt150200!> & H.dR > 0.7 & H.dR < 1.8 & <!ZHmmbb|addCuts!>
ATLAS_Mjj_pt200_dR_Zmm =    <!Cuts|ATLAS_Mjj_pt200!>                 & H.dR < 1.6 & <!ZHmmbb|addCuts!>

ATLAS_Mjj_pt50_Zee =     <!Cuts|ATLAS_Mjj_pt50!>     & <!ZHeebb|addCuts!>
ATLAS_Mjj_pt50100_Zee =  <!Cuts|ATLAS_Mjj_pt50100!>  & <!ZHeebb|addCuts!> 
ATLAS_Mjj_pt100150_Zee = <!Cuts|ATLAS_Mjj_pt100150!> & <!ZHeebb|addCuts!>
ATLAS_Mjj_pt150200_Zee = <!Cuts|ATLAS_Mjj_pt150200!> & <!ZHeebb|addCuts!>
ATLAS_Mjj_pt200_Zee =    <!Cuts|ATLAS_Mjj_pt200!>    & <!ZHeebb|addCuts!>

ATLAS_Mjj_pt50_Zmm =     <!Cuts|ATLAS_Mjj_pt50!>     & <!ZHmmbb|addCuts!>
ATLAS_Mjj_pt50100_Zmm =  <!Cuts|ATLAS_Mjj_pt50100!>  & <!ZHmmbb|addCuts!> 
ATLAS_Mjj_pt100150_Zmm = <!Cuts|ATLAS_Mjj_pt100150!> & <!ZHmmbb|addCuts!>
ATLAS_Mjj_pt150200_Zmm = <!Cuts|ATLAS_Mjj_pt150200!> & <!ZHmmbb|addCuts!>
ATLAS_Mjj_pt200_Zmm =    <!Cuts|ATLAS_Mjj_pt200!>    & <!ZHmmbb|addCuts!>

;!! ------------
;!! new Mjj 
;!! ------------
Mjj_selection: <!ZHbb|preselection!> & <!ZHbb|mcBtag!> & <!ZHbb|zWindow!> & metPuppi_pt < 60. & <!ZHbb|looseHMass!>
;Mjj_pt70 = <!Cuts|Mjj_selection!> & V.pt <= 70. & H.dR > 1.2
;Mjj_pt70150 = <!Cuts|Mjj_selection!> & V.pt > 70.  & V.pt <= 150.
;Mjj_pt150 = <!Cuts|Mjj_selection!> & V.pt > 150. & H.dR < 1.6
Mjj_pt100 = <!Cuts|Mjj_selection!> & V.pt > 50. & V.pt <= 100.
Mjj_pt100150 = <!Cuts|Mjj_selection!> & V.pt > 100.  & V.pt <= 150.
Mjj_pt150 = <!Cuts|Mjj_selection!> & V.pt > 150. & H.dR < 1.6
Mjj_pt100_Zee =    <!Cuts|Mjj_pt100!>  & <!ZHeebb|addCuts!>
Mjj_pt100_Zmm =    <!Cuts|Mjj_pt100!>  & <!ZHmmbb|addCuts!>
Mjj_pt100150_Zee =    <!Cuts|Mjj_pt100150!>  & <!ZHeebb|addCuts!>
Mjj_pt100150_Zmm =    <!Cuts|Mjj_pt100150!>  & <!ZHmmbb|addCuts!>
Mjj_pt150_Zee =    <!Cuts|Mjj_pt150!>  & <!ZHeebb|addCuts!>
Mjj_pt150_Zmm =    <!Cuts|Mjj_pt150!>  & <!ZHmmbb|addCuts!>

;!! ---------------------
;!! Triggers
;!! ---------------------
triggerEE = (triggerFlags[5]>0 || triggerFlags[6]>0)
triggerMM = (triggerFlags[14]>0 || triggerFlags[21]>0 || triggerFlags[22]>0 || triggerFlags[23]>0) 
